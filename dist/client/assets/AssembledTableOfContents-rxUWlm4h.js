import{r as b,j as s,ad as L}from"./index-BQScBO5N.js";import{D as M,e as S,a as A}from"./index-HZy6q__-.js";const $=794,w=1123,g=3.78,I={portada:"Portada",intermedia:"Contenido",contraportada:"Contraportada"},O=new Set(["intervention_data","client_data"]);function D(l){const e=[];let t={blocks:[]};for(const n of l)n.type==="section_separator"?((t.blocks.length>0||t.separator)&&e.push(t),t={separator:n,blocks:[]}):t.blocks.push(n);return(t.blocks.length>0||t.separator)&&e.push(t),e}function E(l){const e=[],t=[],n=[];let o=!1;for(const r of l)M.has(r.type)?(r.type==="back_cover"&&(o=!0),(S[r.type]||"top")==="bottom"?n.push(r):e.push(r)):t.push(r);return{topChrome:e,content:t,bottomChrome:n,hasBackCover:o}}function P(l){const e=[];let t=[];for(const n of l)n.type==="page_break"?(e.push(t),t=[]):t.push(n);return(t.length>0||e.length===0)&&e.push(t),e}function R(l){const e=[];let t=[];for(const n of l)O.has(n.type)?(t.length>0&&(e.push({type:"group",blocks:[...t]}),t=[]),e.push({type:"alignable",block:n})):t.push(n);return t.length>0&&e.push({type:"group",blocks:t}),e}function C(l){let e=0;for(const t of l){const{content:n,hasBackCover:o}=E(t.blocks);o?e+=1:e+=P(n).length}return Math.max(e,1)}function T(l,e,t){return{...l,config:{...l.config,_pageNumber:e,_totalPages:t}}}function H({canvasWidth:l,canvasHeight:e,pageConfig:t,topChrome:n,bottomChrome:o,contentBlocks:r,hasBackCover:i,marginTop:c,marginRight:N,marginBottom:j,marginLeft:y,renderBlock:d,keyPrefix:p,pageNumber:m,totalPages:f}){const _=b.useMemo(()=>R(r),[r]);return s.jsx("div",{className:"bg-white shadow-lg border overflow-hidden",style:{width:l,...i?{height:e}:{minHeight:e},fontSize:`${t.fontSize}px`,fontFamily:t.fontFamily?`"${t.fontFamily}", sans-serif`:void 0},children:s.jsxs("div",{className:"flex flex-col",style:i?{height:e}:{minHeight:e},children:[n.length>0&&s.jsx("div",{className:i?"flex flex-col flex-1":"shrink-0",children:n.map(a=>s.jsx("div",{className:`w-full ${i&&a.type==="back_cover"?"flex-1 flex flex-col":""}`,children:d(T(a,m,f))},`${p}_tc_${a.id}`))}),!i&&r.length>0&&s.jsx("div",{style:{flex:"1 1 0%",display:"flex",flexDirection:"column",overflow:"hidden",padding:`${n.length>0?8:c}px ${N}px ${o.length>0?8:j}px ${y}px`},children:_.map((a,v)=>{if(a.type==="group")return s.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",flexShrink:0},children:a.blocks.map(x=>s.jsx(L.Fragment,{children:d(x)},x.id))},`${p}_grp_${v}`);const h=a.block.config.verticalAlign||"top",u={flexShrink:0,width:"100%"};return h==="center"?(u.marginTop="auto",u.marginBottom="auto"):h==="bottom"&&(u.marginTop="auto"),s.jsx("div",{style:u,children:d(a.block)},a.block.id)})}),o.length>0&&s.jsx("div",{className:"shrink-0 mt-auto",children:o.map(a=>s.jsx("div",{className:"w-full",children:d(T(a,m,f))},`${p}_bc_${a.id}`))})]})})}function G({blocks:l,pageConfig:e,renderBlock:t}){const n=b.useMemo(()=>D(l),[l]),o=b.useMemo(()=>C(n),[n]),r=e.orientation==="portrait",i=r?$:w,c=r?w:$,N=e.margins.top*g,j=e.margins.right*g,y=e.margins.bottom*g,d=e.margins.left*g;let p=0;return s.jsx("div",{className:"flex flex-col items-center gap-2",children:n.map((m,f)=>{const{topChrome:_,content:a,bottomChrome:v,hasBackCover:h}=E(m.blocks),u=P(a);return s.jsxs("div",{className:"flex flex-col items-center w-full gap-2",children:[m.separator&&s.jsxs("div",{className:"w-full flex items-center gap-2 py-1",style:{maxWidth:i},children:[s.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"}),s.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:I[m.separator.config.section]??m.separator.config.section}),s.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"})]}),u.map((x,k)=>(p++,s.jsx(H,{canvasWidth:i,canvasHeight:c,pageConfig:e,topChrome:_,bottomChrome:v,contentBlocks:x,hasBackCover:h&&k===0,marginTop:N,marginRight:j,marginBottom:y,marginLeft:d,renderBlock:t,keyPrefix:`s${f}_p${k}`,pageNumber:p,totalPages:o},`s${f}_p${k}`)))]},f)})})}function z({block:l,allBlocks:e}){const t=l.config.title||"Tabla de contenidos",n=b.useMemo(()=>{const o=[];let r=1,i=0;for(const c of e){if(c.type==="section_separator"||c.type==="page_break"){r++;continue}c.type==="section_title"&&(i++,o.push({number:i,title:c.config.title||"",level:c.config.level||1,pageNumber:r}))}return o},[e]);return s.jsxs("div",{className:"py-4 px-2",children:[s.jsx("h3",{className:"text-base font-bold mb-4",children:t}),n.length===0?s.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[s.jsx(A,{className:"h-4 w-4"}),s.jsx("p",{className:"text-xs italic",children:"No hay titulos de seccion en el documento"})]}):s.jsx("div",{className:"space-y-2 pl-4 pr-2",children:n.map(o=>s.jsxs("div",{className:"flex items-baseline gap-2",style:{paddingLeft:o.level>1?`${(o.level-1)*16}px`:0},children:[s.jsx("span",{className:"font-semibold text-sm shrink-0 w-5 text-right",children:o.number}),s.jsx("span",{className:"font-medium text-sm truncate",children:o.title}),s.jsx("span",{className:"flex-1 border-b border-dotted border-gray-300 min-w-[20px] self-end mb-0.5"}),s.jsx("span",{className:"text-sm text-muted-foreground shrink-0 font-medium",children:o.pageNumber})]},o.number))})]})}export{z as A,G as D};
