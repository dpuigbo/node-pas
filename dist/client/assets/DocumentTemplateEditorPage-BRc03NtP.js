import{c as E,u as N,$ as S,a0 as y,r as n,j as s,L as j,B as d,A as P,a as L,S as D,b as B}from"./index-CnoWWkNU.js";import{u as i}from"./index-wLduaGdf.js";import{B as T,E as A,C as z,P as I}from"./PageConfigDialog-DAFJ6mip.js";import"./eye-DhfWb2iY.js";const K={preventivo:"Preventivo",correctivo:"Correctivo"};function U(){const{id:w}=E(),o=Number(w),b=N(),{data:t,isLoading:C}=S(o||void 0),m=y(o),u=i(e=>e.loadSchema),f=i(e=>e.getSchema),x=i(e=>e.markClean),r=i(e=>e.isDirty),h=i(e=>e.selectBlock),g=i(e=>e.reset),[k,p]=n.useState(!1),[c,v]=n.useState(!1);n.useEffect(()=>{if(t){const e=t.schema||{blocks:[],pageConfig:void 0};u({blocks:e.blocks||[],pageConfig:e.pageConfig||void 0},0,o,!0)}},[t,o,u]),n.useEffect(()=>()=>g(),[g]);const l=n.useCallback(async()=>{if(!c){v(!0);try{const e=f();await m.mutateAsync({schema:e}),x()}catch(e){console.error("Error al guardar:",e)}finally{v(!1)}}},[c,f,m,x]);return n.useEffect(()=>{const e=a=>{if((a.ctrlKey||a.metaKey)&&a.key==="s"){a.preventDefault(),r&&l();return}if(a.key==="Escape"){h(null);return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,l,h]),n.useEffect(()=>{const e=a=>{r&&(a.preventDefault(),a.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[r]),C||!t?s.jsx("div",{className:"flex h-screen items-center justify-center",children:s.jsx(j,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s.jsxs("div",{className:"flex h-screen flex-col overflow-hidden",children:[s.jsxs("div",{className:"flex h-14 items-center justify-between border-b bg-background px-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(d,{variant:"ghost",size:"icon",onClick:()=>b("/configuracion/plantillas"),title:"Volver a plantillas",children:s.jsx(P,{className:"h-4 w-4"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-semibold",children:t.nombre}),s.jsx(L,{className:"bg-blue-100 text-blue-800",children:K[t.tipo]||t.tipo}),r&&s.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Sin guardar"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(d,{variant:"outline",size:"sm",onClick:()=>p(!0),children:[s.jsx(D,{className:"h-4 w-4 mr-1"}),"Pagina"]}),s.jsxs(d,{size:"sm",onClick:l,disabled:c||!r,children:[c?s.jsx(j,{className:"h-4 w-4 animate-spin mr-1"}):s.jsx(B,{className:"h-4 w-4 mr-1"}),"Guardar"]})]})]}),s.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[s.jsx(T,{}),s.jsx(A,{}),s.jsx(z,{})]}),s.jsx(I,{open:k,onOpenChange:p})]})}export{U as default};
