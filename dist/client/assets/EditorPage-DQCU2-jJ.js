import{u as E,j as s,B as j,A as S,a as B,S as P,L as C,b as D,c as L,d as I,e as V,r as l}from"./index-BiJDG7MV.js";import{u as i}from"./index-Bkf-36HS.js";import{B as A,E as z,C as O,P as K}from"./PageConfigDialog-DDfax1xx.js";function T({modeloId:u,modeloNombre:g,versionNumero:t,estado:n,isSaving:a,onSave:x,onOpenPageConfig:d}){const m=E(),c=i(f=>f.isDirty),r={borrador:{label:"Borrador",className:"bg-yellow-100 text-yellow-800"},activo:{label:"Activo",className:"bg-green-100 text-green-800"},obsoleto:{label:"Obsoleto",className:"bg-gray-100 text-gray-600"}}[n]??{label:"Borrador",className:"bg-yellow-100 text-yellow-800"};return s.jsxs("div",{className:"flex h-14 items-center justify-between border-b bg-background px-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(j,{variant:"ghost",size:"icon",onClick:()=>m(`/modelos/${u}`),title:"Volver al modelo",children:s.jsx(S,{className:"h-4 w-4"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-semibold",children:g}),s.jsxs("span",{className:"text-muted-foreground",children:["v",t]}),s.jsx(B,{className:r.className,children:r.label}),c&&s.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Sin guardar"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(j,{variant:"outline",size:"sm",onClick:d,children:[s.jsx(P,{className:"h-4 w-4 mr-1"}),"Pagina"]}),s.jsxs(j,{size:"sm",onClick:x,disabled:a||!c,children:[a?s.jsx(C,{className:"h-4 w-4 animate-spin mr-1"}):s.jsx(D,{className:"h-4 w-4 mr-1"}),"Guardar"]})]})]})}function $(){var y;const{modeloId:u,versionId:g}=L(),t=Number(u),n=Number(g),{data:a,isLoading:x}=I(t||void 0,n||void 0),d=V(t),m=i(e=>e.loadSchema),c=i(e=>e.getSchema),v=i(e=>e.markClean),r=i(e=>e.isDirty),f=i(e=>e.selectBlock),p=i(e=>e.reset),[k,w]=l.useState(!1),[h,N]=l.useState(!1);l.useEffect(()=>{if(a){const e=a.schema||{blocks:[],pageConfig:void 0};m({blocks:e.blocks||[],pageConfig:e.pageConfig||void 0},t,n)}},[a,t,n,m]),l.useEffect(()=>()=>p(),[p]);const b=l.useCallback(async()=>{if(!h){N(!0);try{const e=c();await d.mutateAsync({id:n,schema:e}),v()}catch(e){console.error("Error al guardar:",e)}finally{N(!1)}}},[h,c,d,n,v]);return l.useEffect(()=>{const e=o=>{if((o.ctrlKey||o.metaKey)&&o.key==="s"){o.preventDefault(),r&&b();return}if(o.key==="Escape"){f(null);return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,b,f]),l.useEffect(()=>{const e=o=>{r&&(o.preventDefault(),o.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[r]),x||!a?s.jsx("div",{className:"flex h-screen items-center justify-center",children:s.jsx(C,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s.jsxs("div",{className:"flex h-screen flex-col overflow-hidden",children:[s.jsx(T,{modeloId:t,modeloNombre:((y=a.modeloComponente)==null?void 0:y.nombre)||"Template",versionNumero:a.version,estado:a.estado,isSaving:h,onSave:b,onOpenPageConfig:()=>w(!0)}),s.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[s.jsx(A,{}),s.jsx(z,{}),s.jsx(O,{})]}),s.jsx(K,{open:k,onOpenChange:w})]})}export{$ as default};
