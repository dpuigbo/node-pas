import{c as y,R as E,u as ee,j as e,B as N,A as se,a as ae,S as te,L as V,b as le,C as U,F as re,d as W,r as b,T as C,P as _,X as ce,D as ne,e as ie,f as oe,g as de,h as x,I as h,i as xe,k as me,l as he,m as ue}from"./index-B75zGLjO.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],ge=y("AlignLeft",pe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ve=y("ArrowDown",fe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],je=y("ArrowUp",ye);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],K=y("Calendar",be);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],we=y("CircleCheckBig",Ne);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],G=y("Copy",ke);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],_e=y("GripVertical",Ce);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],$e=y("Hash",Pe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M6 20V4",key:"1w1bmo"}],["path",{d:"M18 20V4",key:"o2hl4u"}]],Me=y("Heading",Ee);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],J=y("Image",Se);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],De=y("ListChecks",Be);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M5 12h14",key:"1ays0h"}]],Le=y("Minus",Ie);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],X=y("Pen",Ae);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Te=y("Square",qe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],Oe=y("Table",ze);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]],Fe=y("Type",Re),z=l=>{let a;const t=new Set,s=(m,d)=>{const f=typeof m=="function"?m(a):m;if(!Object.is(f,a)){const w=a;a=d??(typeof f!="object"||f===null)?f:Object.assign({},a,f),t.forEach(u=>u(a,w))}},r=()=>a,n={setState:s,getState:r,getInitialState:()=>o,subscribe:m=>(t.add(m),()=>t.delete(m))},o=a=l(s,r,n);return n},He=(l=>l?z(l):z),Ve=l=>l;function Ue(l,a=Ve){const t=E.useSyncExternalStore(l.subscribe,E.useCallback(()=>a(l.getState()),[l,a]),E.useCallback(()=>a(l.getInitialState()),[l,a]));return E.useDebugValue(t),t}const O=l=>{const a=He(l),t=s=>Ue(a,s);return Object.assign(t,a),t},We=(l=>l?O(l):O),B={orientation:"portrait",margins:{top:20,right:15,bottom:20,left:15},fontSize:10},I={full:"Completo",half:"Mitad",third:"Tercio",two_thirds:"Dos tercios"},L={full:"w-full",half:"w-1/2",third:"w-1/3",two_thirds:"w-2/3"},Y={general:"General",level1:"Nivel 1",level2:"Nivel 2",level3:"Nivel 3"},Ke={general:"bg-gray-100 text-gray-700",level1:"bg-green-100 text-green-700",level2:"bg-amber-100 text-amber-700",level3:"bg-red-100 text-red-700"},Q=new Map;function j(l){Q.set(l.definition.type,l)}function Z(l){return Q.get(l)}const v={header:{type:"header",label:"Cabecera",icon:"FileText",category:"structure",hasData:!1,defaultConfig:{title:"Informe de Mantenimiento",subtitle:"",showLogo:!0,showDate:!0,showReference:!0,logoPosition:"left",logoUrl:""}},section_title:{type:"section_title",label:"Titulo de seccion",icon:"Heading",category:"structure",hasData:!1,defaultConfig:{title:"Nueva seccion",description:"",level:1,color:"#2563eb"}},divider:{type:"divider",label:"Separador",icon:"Minus",category:"structure",hasData:!1,defaultConfig:{style:"solid",spacing:"medium",color:"#e5e7eb"}},text_field:{type:"text_field",label:"Campo de texto",icon:"Type",category:"data",hasData:!0,defaultConfig:{key:"",label:"Campo de texto",required:!1,width:"full",helpText:"",placeholder:""}},number_field:{type:"number_field",label:"Campo numerico",icon:"Hash",category:"data",hasData:!0,defaultConfig:{key:"",label:"Campo numerico",required:!1,width:"full",helpText:"",unit:"",min:null,max:null}},date_field:{type:"date_field",label:"Campo de fecha",icon:"Calendar",category:"data",hasData:!0,defaultConfig:{key:"",label:"Fecha",required:!1,width:"full",helpText:""}},text_area:{type:"text_area",label:"Area de texto",icon:"AlignLeft",category:"data",hasData:!0,defaultConfig:{key:"",label:"Area de texto",required:!1,width:"full",helpText:"",rows:3,placeholder:""}},select_field:{type:"select_field",label:"Selector",icon:"ChevronDown",category:"data",hasData:!0,defaultConfig:{key:"",label:"Selector",required:!1,width:"full",helpText:"",options:[]}},tristate:{type:"tristate",label:"Inspeccion OK/NOK/NA",icon:"CheckCircle",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Punto de inspeccion",withObservation:!0,required:!1,maintenanceLevel:"general"}},checklist:{type:"checklist",label:"Lista de verificacion",icon:"ListChecks",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Lista de verificacion",items:[]}},table:{type:"table",label:"Tabla de datos",icon:"Table",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Tabla",columns:[],fixedRows:[],allowAddRows:!0,minRows:0,maxRows:50}},image:{type:"image",label:"Imagen",icon:"Image",category:"media",hasData:!0,defaultConfig:{key:"",label:"Imagen",allowMultiple:!1,maxFiles:1,maxSizeMB:5,width:"full"}},signature:{type:"signature",label:"Firma",icon:"Pen",category:"media",hasData:!0,defaultConfig:{key:"",label:"Firma",role:"Tecnico",required:!1,width:"half"}}},Ge=[{id:"structure",label:"Estructura",types:["header","section_title","divider"]},{id:"data",label:"Campos de datos",types:["text_field","number_field","date_field","text_area","select_field"]},{id:"inspection",label:"Inspeccion",types:["tristate","checklist","table"]},{id:"media",label:"Media y firma",types:["image","signature"]}];function Je(l,a,t){const s={...l},r=a.split(".");let c=s;for(let n=0;n<r.length-1;n++){const o=r[n],m=r[n+1],d=m!=null&&/^\d+$/.test(m);Array.isArray(c[o])?c[o]=[...c[o]]:typeof c[o]=="object"&&c[o]!==null?c[o]={...c[o]}:c[o]=d?[]:{},c=c[o]}const i=r[r.length-1];return i!=null&&(c[i]=t),s}function R(l,a){const t=l.replace(/_/g,"_"),s=a.filter(c=>c.type===l).map(c=>{const n=(c.config.key||"").match(new RegExp(`^${t}_(\\d+)$`));return(n==null?void 0:n[1])!=null?parseInt(n[1],10):0}),r=s.length>0?Math.max(...s):0;return`${t}_${r+1}`}function F(){return crypto.randomUUID()}const g=We((l,a)=>({blocks:[],pageConfig:{...B},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,loadSchema:(t,s,r)=>{l({blocks:t.blocks||[],pageConfig:t.pageConfig||{...B},selectedBlockId:null,isDirty:!1,versionId:r,modeloId:s})},addBlock:(t,s)=>{const r=v[t];if(!r)return;const{blocks:c}=a(),i={...r.defaultConfig};r.hasData&&(i.key=R(t,c));const n={id:F(),type:t,config:i},o=[...c];s!==void 0&&s>=0&&s<=c.length?o.splice(s,0,n):o.push(n),l({blocks:o,isDirty:!0,selectedBlockId:n.id})},removeBlock:t=>{const{blocks:s,selectedBlockId:r}=a();l({blocks:s.filter(c=>c.id!==t),isDirty:!0,selectedBlockId:r===t?null:r})},duplicateBlock:t=>{const{blocks:s}=a(),r=s.findIndex(d=>d.id===t);if(r===-1)return;const c=s[r],i=v[c.type],n=JSON.parse(JSON.stringify(c.config));i!=null&&i.hasData&&n.key&&(n.key=R(c.type,s));const o={id:F(),type:c.type,config:n},m=[...s];m.splice(r+1,0,o),l({blocks:m,isDirty:!0,selectedBlockId:o.id})},moveBlock:(t,s)=>{const{blocks:r}=a(),c=r.findIndex(d=>d.id===t);if(c===-1)return;const i=s==="up"?c-1:c+1;if(i<0||i>=r.length)return;const n=[...r],o=n[c],m=n[i];n[c]=m,n[i]=o,l({blocks:n,isDirty:!0})},reorderBlocks:t=>{const{blocks:s}=a(),r=new Map(s.map(n=>[n.id,n])),c=t.map(n=>r.get(n)).filter(Boolean),i=s.filter(n=>!t.includes(n.id));l({blocks:[...c,...i],isDirty:!0})},updateBlockConfig:(t,s,r)=>{const{blocks:c}=a();l({blocks:c.map(i=>i.id===t?{...i,config:Je(i.config,s,r)}:i),isDirty:!0})},selectBlock:t=>{l({selectedBlockId:t})},updatePageConfig:t=>{const{pageConfig:s}=a();l({pageConfig:{...s,...t},isDirty:!0})},getSchema:()=>{const{blocks:t,pageConfig:s}=a();return{blocks:t,pageConfig:s}},markClean:()=>{l({isDirty:!1})},reset:()=>{l({blocks:[],pageConfig:{...B},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null})}}));function Xe({modeloNombre:l,versionNumero:a,estado:t,isSaving:s,onSave:r,onOpenPageConfig:c}){const i=ee(),n=g(d=>d.isDirty),m={borrador:{label:"Borrador",className:"bg-yellow-100 text-yellow-800"},activo:{label:"Activo",className:"bg-green-100 text-green-800"},obsoleto:{label:"Obsoleto",className:"bg-gray-100 text-gray-600"}}[t]??{label:"Borrador",className:"bg-yellow-100 text-yellow-800"};return e.jsxs("div",{className:"flex h-14 items-center justify-between border-b bg-background px-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>i("/modelos"),title:"Volver a modelos",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:l}),e.jsxs("span",{className:"text-muted-foreground",children:["v",a]}),e.jsx(ae,{className:m.className,children:m.label}),n&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Sin guardar"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Pagina"]}),e.jsxs(N,{size:"sm",onClick:r,disabled:s||!n,children:[s?e.jsx(V,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(le,{className:"h-4 w-4 mr-1"}),"Guardar"]})]})]})}const Ye={FileText:re,Heading:Me,Minus:Le,Type:Fe,Hash:$e,Calendar:K,AlignLeft:ge,ChevronDown:U,CheckCircle:we,ListChecks:De,Table:Oe,Image:J,Pen:X};function Qe(){const l=g(a=>a.addBlock);return e.jsxs("div",{className:"flex w-56 flex-col border-r bg-background overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 border-b",children:e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Bloques"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-4",children:Ge.map(a=>e.jsxs("div",{children:[e.jsx("p",{className:"px-2 pb-1 text-xs font-medium text-muted-foreground uppercase tracking-wide",children:a.label}),e.jsx("div",{className:"space-y-0.5",children:a.types.map(t=>{const s=v[t],r=Ye[s.icon];return e.jsxs("button",{onClick:()=>l(t),className:W("flex w-full items-center gap-2 rounded-md px-2 py-2 text-sm","hover:bg-accent hover:text-accent-foreground transition-colors","cursor-pointer select-none"),title:`Anadir ${s.label}`,children:[r&&e.jsx(r,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.label})]},t)})})]},a.id))})]})}const D=794,H=1123;function Ze({block:l,index:a,totalBlocks:t}){const s=g(u=>u.selectedBlockId),r=g(u=>u.selectBlock),c=g(u=>u.removeBlock),i=g(u=>u.duplicateBlock),n=g(u=>u.moveBlock),o=s===l.id,m=Z(l.type),[d,f]=b.useState(!1);if(!m)return e.jsxs("div",{className:"rounded border border-dashed border-destructive bg-destructive/5 p-4 text-sm text-destructive",children:["Bloque desconocido: ",l.type]});const w=m.EditorPreview;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:W("group relative rounded-sm transition-all",o&&"ring-2 ring-primary ring-offset-1",!o&&d&&"ring-1 ring-primary/30"),onClick:u=>{u.stopPropagation(),r(l.id)},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[(d||o)&&e.jsxs("div",{className:"absolute -left-10 top-0 flex flex-col gap-0.5 z-10",children:[e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground",onClick:u=>{u.stopPropagation(),n(l.id,"up")},disabled:a===0,title:"Mover arriba",children:e.jsx(je,{className:"h-3 w-3"})}),e.jsx("div",{className:"rounded p-1 text-muted-foreground cursor-grab",children:e.jsx(_e,{className:"h-3 w-3"})}),e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground",onClick:u=>{u.stopPropagation(),n(l.id,"down")},disabled:a===t-1,title:"Mover abajo",children:e.jsx(ve,{className:"h-3 w-3"})})]}),(d||o)&&e.jsxs("div",{className:"absolute -right-10 top-0 flex flex-col gap-0.5 z-10",children:[e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground",onClick:u=>{u.stopPropagation(),i(l.id)},title:"Duplicar",children:e.jsx(G,{className:"h-3 w-3"})}),e.jsx("button",{className:"rounded p-1 hover:bg-destructive/10 text-destructive",onClick:u=>{u.stopPropagation(),c(l.id)},title:"Eliminar",children:e.jsx(C,{className:"h-3 w-3"})})]}),e.jsx(w,{block:l,isSelected:o})]}),e.jsx("div",{className:"flex justify-center py-0.5 opacity-0 hover:opacity-100 transition-opacity",children:e.jsx("button",{className:"flex items-center gap-1 rounded-full bg-primary/10 px-2 py-0.5 text-xs text-primary hover:bg-primary/20 transition-colors",onClick:u=>{u.stopPropagation()},title:"Insertar bloque aqui",children:e.jsx(_,{className:"h-3 w-3"})})})]})}function es(){const l=g(d=>d.blocks),a=g(d=>d.pageConfig),t=g(d=>d.selectBlock),s=b.useRef(null),[r,c]=b.useState(1),i=b.useCallback(()=>{if(!s.current)return;const f=s.current.clientWidth-120,w=Math.min(f/D,1);c(w)},[]);b.useEffect(()=>{i();const d=new ResizeObserver(i);return s.current&&d.observe(s.current),()=>d.disconnect()},[i]);const n=a.orientation==="portrait",o=n?D:H,m=n?H:D;return e.jsx("div",{ref:s,className:"flex-1 overflow-y-auto bg-muted/40 p-8",onClick:()=>t(null),children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-white shadow-lg border relative",style:{width:o,minHeight:m,transform:`scale(${r})`,transformOrigin:"top center",marginBottom:`${(m*r-m)*-1}px`,padding:`${a.margins.top*3.78}px ${a.margins.right*3.78}px ${a.margins.bottom*3.78}px ${a.margins.left*3.78}px`,fontSize:`${a.fontSize}px`},children:[e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-200 pointer-events-none z-20",style:{top:m},children:e.jsx("span",{className:"absolute right-2 -top-4 text-[10px] text-red-300 bg-white px-1",children:"Corte de pagina"})}),l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-muted-foreground/50",children:[e.jsx("p",{className:"text-lg font-medium",children:"Canvas vacio"}),e.jsx("p",{className:"text-sm mt-1",children:"Haz clic en un bloque de la paleta para empezar"})]}):e.jsx("div",{className:"space-y-0",children:l.map((d,f)=>e.jsx(Ze,{block:d,index:f,totalBlocks:l.length},d.id))})]})})})}function ss(){const l=g(d=>d.selectedBlockId),a=g(d=>d.blocks),t=g(d=>d.selectBlock),s=g(d=>d.updateBlockConfig),r=g(d=>d.duplicateBlock),c=g(d=>d.removeBlock);if(!l)return e.jsx("div",{className:"flex w-80 flex-col border-l bg-background",children:e.jsx("div",{className:"flex flex-1 items-center justify-center p-4 text-sm text-muted-foreground",children:"Selecciona un bloque para configurarlo"})});const i=a.find(d=>d.id===l);if(!i)return null;const n=Z(i.type),o=v[i.type];if(!n||!o)return null;const m=n.ConfigPanel;return e.jsxs("div",{className:"flex w-80 flex-col border-l bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm font-semibold",children:o.label})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>t(null),children:e.jsx(ce,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(m,{block:i,onChange:(d,f)=>s(i.id,d,f)})}),e.jsxs("div",{className:"flex items-center gap-2 border-t px-4 py-3",children:[e.jsxs(N,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>r(i.id),children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Duplicar"]}),e.jsxs(N,{variant:"outline",size:"sm",className:"flex-1 text-destructive hover:bg-destructive/10",onClick:()=>{c(i.id)},children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})}function as({open:l,onOpenChange:a}){const t=g(r=>r.pageConfig),s=g(r=>r.updatePageConfig);return e.jsx(ne,{open:l,onOpenChange:a,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsx(oe,{children:e.jsx(de,{children:"Configuracion de pagina"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Orientacion"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${t.orientation==="portrait"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>s({orientation:"portrait"}),children:"Vertical"}),e.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${t.orientation==="landscape"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>s({orientation:"landscape"}),children:"Horizontal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Margenes (mm)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["top","right","bottom","left"].map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-16 capitalize",children:r==="top"?"Arriba":r==="right"?"Derecha":r==="bottom"?"Abajo":"Izquierda"}),e.jsx(h,{type:"number",min:5,max:50,value:t.margins[r],onChange:c=>s({margins:{...t.margins,[r]:Math.max(5,Math.min(50,Number(c.target.value)||5))}}),className:"h-8 w-full"})]},r))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Tamano de fuente base (px)"}),e.jsx(h,{type:"number",min:8,max:14,value:t.fontSize,onChange:r=>s({fontSize:Math.max(8,Math.min(14,Number(r.target.value)||10))}),className:"h-8"})]})]})]})})}function ts({block:l}){const a=l.config,t=a.title||"Informe de Mantenimiento",s=a.subtitle||"",r=a.showLogo!==!1,c=a.showDate!==!1,i=a.showReference!==!1,n=a.logoPosition||"left";return e.jsx("div",{className:"border-b pb-3 mb-2",children:e.jsxs("div",{className:`flex items-start gap-4 ${n==="right"?"flex-row-reverse":n==="center"?"flex-col items-center":""}`,children:[r&&e.jsx("div",{className:"flex h-14 w-14 shrink-0 items-center justify-center rounded-lg bg-gray-100 border border-dashed border-gray-300",children:e.jsx(xe,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{className:`flex-1 ${n==="center"?"text-center":""}`,children:[e.jsx("h1",{className:"text-lg font-bold leading-tight",children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:s}),e.jsxs("div",{className:"flex gap-4 mt-2 text-[10px] text-gray-400",children:[c&&e.jsx("span",{children:"Fecha: ____/____/________"}),i&&e.jsx("span",{children:"Ref: __________"})]})]})]})})}function ls({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Titulo"}),e.jsx(h,{value:t.title||"",onChange:s=>a("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Subtitulo"}),e.jsx(h,{value:t.subtitle||"",onChange:s=>a("subtitle",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showLogo",checked:t.showLogo!==!1,onChange:s=>a("showLogo",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:"showLogo",className:"text-xs cursor-pointer",children:"Mostrar logo"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Posicion del logo"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right"].map(s=>e.jsx("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(t.logoPosition||"left")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("logoPosition",s),children:s==="left"?"Izquierda":s==="center"?"Centro":"Derecha"},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"URL del logo"}),e.jsx(h,{value:t.logoUrl||"",onChange:s=>a("logoUrl",s.target.value),placeholder:"https://...",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showDate",checked:t.showDate!==!1,onChange:s=>a("showDate",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:"showDate",className:"text-xs cursor-pointer",children:"Mostrar fecha"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showReference",checked:t.showReference!==!1,onChange:s=>a("showReference",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:"showReference",className:"text-xs cursor-pointer",children:"Mostrar referencia"})]})]})}j({definition:v.header,EditorPreview:ts,ConfigPanel:ls});function rs({block:l}){const a=l.config,t=a.title||"Seccion",s=a.description||"",r=a.level||1,c=a.color||"#2563eb",i={1:"text-base font-bold",2:"text-sm font-semibold",3:"text-xs font-semibold"};return e.jsxs("div",{className:"flex items-start gap-2 py-2",children:[e.jsx("div",{className:"w-1 shrink-0 rounded-full self-stretch",style:{backgroundColor:c}}),e.jsxs("div",{children:[e.jsx("div",{className:i[r]||i[1],children:t}),s&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5",children:s})]})]})}function cs({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Titulo"}),e.jsx(h,{value:t.title||"",onChange:s=>a("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Descripcion"}),e.jsx(h,{value:t.description||"",onChange:s=>a("description",s.target.value),placeholder:"Opcional",className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Nivel"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(s=>e.jsxs("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(t.level||1)===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("level",s),children:["Nivel ",s]},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:t.color||"#2563eb",onChange:s=>a("color",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(h,{value:t.color||"#2563eb",onChange:s=>a("color",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]})]})}j({definition:v.section_title,EditorPreview:rs,ConfigPanel:cs});function ns({block:l}){const a=l.config,t=a.style||"solid",s=a.spacing||"medium",r=a.color||"#e5e7eb",c={small:"py-1",medium:"py-3",large:"py-5"};if(t==="space")return e.jsx("div",{className:c[s]||c.medium});const i=t==="dashed"?"dashed":t==="dotted"?"dotted":"solid";return e.jsx("div",{className:c[s]||c.medium,children:e.jsx("hr",{style:{borderTopStyle:i,borderTopColor:r,borderTopWidth:"1px"},className:"border-0"})})}function is({block:l,onChange:a}){const t=l.config,s=[{value:"solid",label:"Solido"},{value:"dashed",label:"Discontinuo"},{value:"dotted",label:"Punteado"},{value:"space",label:"Espacio"}],r=[{value:"small",label:"Pequeno"},{value:"medium",label:"Mediano"},{value:"large",label:"Grande"}];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Estilo"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:s.map(c=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(t.style||"solid")===c.value?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("style",c.value),children:c.label},c.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Espaciado"}),e.jsx("div",{className:"flex gap-1",children:r.map(c=>e.jsx("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(t.spacing||"medium")===c.value?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("spacing",c.value),children:c.label},c.value))})]}),t.style!=="space"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:t.color||"#e5e7eb",onChange:c=>a("color",c.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(h,{value:t.color||"#e5e7eb",onChange:c=>a("color",c.target.value),className:"h-8 font-mono text-xs flex-1"})]})]})]})}j({definition:v.divider,EditorPreview:ns,ConfigPanel:is});function P({block:l,children:a}){const t=l.config,s=t.label||"Campo",r=!!t.required,c=t.helpText||"",i=t.width||"full";return e.jsx("div",{className:`${L[i]} py-1`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700",children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),a,c&&e.jsx("div",{className:"text-[10px] text-gray-400",children:c})]})})}function os({block:l}){const a=l.config.placeholder||"";return e.jsx(P,{block:l,children:e.jsx("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center",children:a&&e.jsx("span",{className:"text-[10px] text-gray-300",children:a})})})}function $({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:s=>a("label",s.target.value),placeholder:"Etiqueta del campo",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!t.required,onChange:s=>a("required",s.target.checked),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(x,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(I).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${t.width===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("width",s),children:r},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Texto de ayuda"}),e.jsx(h,{value:t.helpText||"",onChange:s=>a("helpText",s.target.value),placeholder:"Opcional",className:"h-8"})]})]})}function ds({block:l,onChange:a}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{block:l,onChange:a}),e.jsxs("div",{className:"border-t pt-3 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Placeholder"}),e.jsx(h,{value:l.config.placeholder||"",onChange:t=>a("placeholder",t.target.value),placeholder:"Texto de ejemplo...",className:"h-8"})]})]})}j({definition:v.text_field,EditorPreview:os,ConfigPanel:ds});function xs({block:l}){const a=l.config,t=a.unit||"",s=a.min,r=a.max;return e.jsxs(P,{block:l,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-7 flex-1 rounded border border-gray-200 bg-gray-50 px-2 flex items-center",children:e.jsx("span",{className:"text-[10px] text-gray-300",children:"0"})}),t&&e.jsx("span",{className:"shrink-0 rounded bg-gray-100 px-1.5 py-1 text-[10px] font-medium text-gray-500",children:t})]}),(s!==null||r!==null)&&e.jsxs("div",{className:"text-[9px] text-gray-300 mt-0.5",children:[s!==null&&`Min: ${s}`,s!==null&&r!==null&&" Â· ",r!==null&&`Max: ${r}`]})]})}function ms({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{block:l,onChange:a}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Unidad"}),e.jsx(h,{value:t.unit||"",onChange:s=>a("unit",s.target.value),placeholder:"mm, V, A, bar...",className:"h-8"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Minimo"}),e.jsx(h,{type:"number",value:t.min!==null&&t.min!==void 0?String(t.min):"",onChange:s=>a("min",s.target.value?Number(s.target.value):null),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Maximo"}),e.jsx(h,{type:"number",value:t.max!==null&&t.max!==void 0?String(t.max):"",onChange:s=>a("max",s.target.value?Number(s.target.value):null),className:"h-8"})]})]})]})]})}j({definition:v.number_field,EditorPreview:xs,ConfigPanel:ms});function hs({block:l}){return e.jsx(P,{block:l,children:e.jsxs("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-300",children:"DD/MM/AAAA"}),e.jsx(K,{className:"h-3 w-3 text-gray-300"})]})})}function us({block:l,onChange:a}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{block:l,onChange:a}),e.jsx("p",{className:"text-[10px] text-muted-foreground border-t pt-2",children:"Este campo no tiene configuracion adicional."})]})}j({definition:v.date_field,EditorPreview:hs,ConfigPanel:us});function ps({block:l}){const a=l.config,t=a.rows||3,s=a.placeholder||"";return e.jsx(P,{block:l,children:e.jsx("div",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-1",style:{minHeight:`${t*18}px`},children:s&&e.jsx("span",{className:"text-[10px] text-gray-300",children:s})})})}function gs({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{block:l,onChange:a}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Filas visibles"}),e.jsx(h,{type:"number",min:2,max:10,value:t.rows||3,onChange:s=>a("rows",Math.max(2,Math.min(10,Number(s.target.value)||3))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Placeholder"}),e.jsx(h,{value:t.placeholder||"",onChange:s=>a("placeholder",s.target.value),placeholder:"Texto de ejemplo...",className:"h-8"})]})]})]})}j({definition:v.text_area,EditorPreview:ps,ConfigPanel:gs});function fs({block:l}){const a=l.config.options||[];return e.jsx(P,{block:l,children:e.jsxs("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-300",children:a.length>0?`${a.length} opciones`:"Sin opciones"}),e.jsx(U,{className:"h-3 w-3 text-gray-300"})]})})}function vs({options:l,onChange:a}){const t=()=>{const c=l.length+1;a([...l,{value:`opcion_${c}`,label:`Opcion ${c}`}])},s=c=>{a(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((m,d)=>d===c?{...m,[i]:n}:m);a(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs",children:"Opciones"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin opciones definidas"}),l.map((c,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{value:c.value,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"value",o)},placeholder:"valor",className:"h-7 text-xs font-mono flex-1"}),e.jsx(h,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-7 text-xs flex-1"}),e.jsx("button",{onClick:()=>s(i),className:"shrink-0 rounded p-1 text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(C,{className:"h-3 w-3"})})]},i)),e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:t,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Anadir opcion"]})]})}function ys({block:l,onChange:a}){const t=l.config.options||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{block:l,onChange:a}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(vs,{options:t,onChange:s=>a("options",s)})})]})}j({definition:v.select_field,EditorPreview:fs,ConfigPanel:ys});function js({block:l}){const a=l.config,t=a.label||"Punto de inspeccion",s=a.withObservation!==!1,r=a.maintenanceLevel||"general",c=!!a.required;return e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`shrink-0 rounded px-1.5 py-0.5 text-[9px] font-medium ${Ke[r]}`,children:Y[r]}),e.jsxs("span",{className:"flex-1 text-xs font-medium",children:[t,c&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"rounded border border-green-200 bg-green-50 px-2 py-0.5 text-[9px] font-medium text-green-600",children:"OK"}),e.jsx("span",{className:"rounded border border-red-200 bg-red-50 px-2 py-0.5 text-[9px] font-medium text-red-600",children:"NOK"}),e.jsx("span",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-[9px] font-medium text-gray-500",children:"N/A"})]})]}),s&&e.jsx("div",{className:"mt-1 ml-16",children:e.jsx("div",{className:"h-5 rounded border border-dashed border-gray-200 bg-gray-50/50 px-2 flex items-center",children:e.jsx("span",{className:"text-[9px] text-gray-300",children:"Observaciones..."})})})]})}function bs({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:s=>a("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Nivel de mantenimiento"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(Y).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(t.maintenanceLevel||"general")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("maintenanceLevel",s),children:r},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`withObs-${l.id}`,checked:t.withObservation!==!1,onChange:s=>a("withObservation",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:`withObs-${l.id}`,className:"text-xs cursor-pointer",children:"Con campo de observaciones"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!t.required,onChange:s=>a("required",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]})]})}j({definition:v.tristate,EditorPreview:js,ConfigPanel:bs});function Ns({block:l}){const a=l.config,t=a.label||"Lista de verificacion",s=a.items||[];return e.jsxs("div",{className:"py-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:t}),s.length===0?e.jsx("div",{className:"text-[10px] text-gray-300 italic",children:"Sin items definidos"}):e.jsx("div",{className:"space-y-0.5",children:s.map((r,c)=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Te,{className:"h-3 w-3 text-gray-300 shrink-0"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:r.label})]},c))})]})}function ws({items:l,onChange:a}){const t=()=>{const c=l.length+1;a([...l,{key:`item_${c}`,label:`Item ${c}`}])},s=c=>{a(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((m,d)=>d===c?{...m,[i]:n}:m);a(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs",children:"Items"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin items definidos"}),l.map((c,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{value:c.key,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"key",o)},placeholder:"clave",className:"h-7 text-xs font-mono flex-1"}),e.jsx(h,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-7 text-xs flex-1"}),e.jsx("button",{onClick:()=>s(i),className:"shrink-0 rounded p-1 text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(C,{className:"h-3 w-3"})})]},i)),e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:t,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Anadir item"]})]})}function ks({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:s=>a("label",s.target.value),className:"h-8"})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(ws,{items:t.items||[],onChange:s=>a("items",s)})})]})}j({definition:v.checklist,EditorPreview:Ns,ConfigPanel:ks});function Cs({block:l}){const a=l.config,t=a.label||"Tabla",s=a.columns||[],r=a.fixedRows||[],c=a.allowAddRows!==!1;if(s.length===0)return e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:t}),e.jsx("div",{className:"rounded border border-dashed border-gray-200 p-4 text-center text-[10px] text-gray-300",children:"Sin columnas definidas"})]});const i=r.slice(0,3),n=r.length>3?r.length-3:0;return e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:t}),e.jsxs("div",{className:"rounded border overflow-hidden",children:[e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-800 text-white",children:s.map(o=>e.jsx("th",{className:"px-2 py-1 text-left font-medium",style:{width:o.width!=="auto"?o.width:void 0},children:o.label},o.key))})}),e.jsx("tbody",{children:i.length>0?i.map((o,m)=>e.jsx("tr",{className:m%2===1?"bg-gray-50":"",children:s.map(d=>e.jsx("td",{className:"px-2 py-1 text-gray-500",children:String(o[d.key]||"")},d.key))},m)):e.jsx("tr",{children:s.map(o=>e.jsx("td",{className:"px-2 py-1",children:e.jsx("div",{className:"h-3 bg-gray-100 rounded"})},o.key))})})]}),n>0&&e.jsxs("div",{className:"bg-gray-50 border-t px-2 py-0.5 text-[9px] text-gray-400 text-center",children:["y ",n," mas..."]}),c&&e.jsx("div",{className:"bg-gray-50 border-t px-2 py-0.5 text-[9px] text-gray-400 text-center italic",children:"+ filas dinamicas"})]})]})}const _s=[{value:"text",label:"Texto"},{value:"number",label:"Numero"},{value:"date",label:"Fecha"},{value:"tristate",label:"Tristate"},{value:"select",label:"Selector"}];function Ps({columns:l,onChange:a}){const t=()=>{const c=l.length+1;a([...l,{key:`col_${c}`,label:`Columna ${c}`,type:"text",width:"auto"}])},s=c=>{a(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((m,d)=>d===c?{...m,[i]:n}:m);a(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs",children:"Columnas"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin columnas definidas"}),l.map((c,i)=>e.jsxs("div",{className:"rounded border p-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[10px] font-medium text-muted-foreground",children:["Columna ",i+1]}),e.jsx("button",{onClick:()=>s(i),className:"rounded p-0.5 text-muted-foreground hover:text-destructive",children:e.jsx(C,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsx(h,{value:c.key,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"key",o)},placeholder:"clave",className:"h-6 text-[10px] font-mono"}),e.jsx(h,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-6 text-[10px]"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:c.type,onChange:n=>r(i,"type",n.target.value),className:"h-6 flex-1 rounded border text-[10px] px-1",children:_s.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsx(h,{value:c.width,onChange:n=>r(i,"width",n.target.value),placeholder:"auto",className:"h-6 w-16 text-[10px]",title:"Ancho (auto, 100px, 20%, etc.)"})]})]},i)),e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:t,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Anadir columna"]})]})}function $s({columns:l,rows:a,onChange:t}){if(l.length===0)return e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Filas fijas"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Define columnas primero para poder anadir filas fijas."})]});const s=()=>{const i={};l.forEach(n=>{i[n.key]=""}),t([...a,i])},r=i=>{t(a.filter((n,o)=>o!==i))},c=(i,n,o)=>{const m=a.map((d,f)=>f===i?{...d,[n]:o}:d);t(m)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs",children:["Filas fijas (",a.length,")"]}),a.length>0&&e.jsx("div",{className:"rounded border overflow-x-auto",children:e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[l.map(i=>e.jsx("th",{className:"px-1.5 py-1 text-left font-medium",children:i.label},i.key)),e.jsx("th",{className:"w-6"})]})}),e.jsx("tbody",{children:a.map((i,n)=>e.jsxs("tr",{className:"border-t",children:[l.map(o=>e.jsx("td",{className:"px-0.5 py-0.5",children:e.jsx(h,{value:String(i[o.key]||""),onChange:m=>c(n,o.key,m.target.value),className:"h-5 text-[10px] border-0 bg-transparent px-1"})},o.key)),e.jsx("td",{className:"px-0.5",children:e.jsx("button",{onClick:()=>r(n),className:"rounded p-0.5 text-muted-foreground hover:text-destructive",children:e.jsx(C,{className:"h-2.5 w-2.5"})})})]},n))})]})}),e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:s,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Anadir fila fija"]})]})}function Es({block:l,onChange:a}){const t=l.config,s=t.columns||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:r=>{const c=r.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",c)},placeholder:"nombre_tabla",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:r=>a("label",r.target.value),className:"h-8"})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(Ps,{columns:s,onChange:r=>a("columns",r)})}),e.jsx("div",{className:"border-t pt-3",children:e.jsx($s,{columns:s,rows:t.fixedRows||[],onChange:r=>a("fixedRows",r)})}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`allowAdd-${l.id}`,checked:t.allowAddRows!==!1,onChange:r=>a("allowAddRows",r.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:`allowAdd-${l.id}`,className:"text-xs cursor-pointer",children:"Permitir anadir filas"})]}),t.allowAddRows!==!1&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Min filas"}),e.jsx(h,{type:"number",min:0,value:t.minRows||0,onChange:r=>a("minRows",Math.max(0,Number(r.target.value)||0)),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Max filas"}),e.jsx(h,{type:"number",min:1,value:t.maxRows||50,onChange:r=>a("maxRows",Math.max(1,Number(r.target.value)||50)),className:"h-8"})]})]})]})]})}j({definition:v.table,EditorPreview:Cs,ConfigPanel:Es});function Ms({block:l}){const a=l.config,t=a.label||"Imagen",s=a.maxFiles||1,r=a.width||"full";return e.jsxs("div",{className:`${L[r]} py-1`,children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:t}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border-2 border-dashed border-gray-200 bg-gray-50/50 p-6 gap-1",children:[e.jsx(J,{className:"h-8 w-8 text-gray-300"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["Hasta ",s," archivo",s>1?"s":""]})]})]})}function Ss({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:s=>a("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`multi-${l.id}`,checked:!!t.allowMultiple,onChange:s=>a("allowMultiple",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:`multi-${l.id}`,className:"text-xs cursor-pointer",children:"Permitir multiples"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Maximo de archivos"}),e.jsx(h,{type:"number",min:1,max:20,value:t.maxFiles||1,onChange:s=>a("maxFiles",Math.max(1,Math.min(20,Number(s.target.value)||1))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Tamano maximo (MB)"}),e.jsx(h,{type:"number",min:1,max:50,value:t.maxSizeMB||5,onChange:s=>a("maxSizeMB",Math.max(1,Math.min(50,Number(s.target.value)||5))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(I).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(t.width||"full")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("width",s),children:r},s))})]})]})}j({definition:v.image,EditorPreview:Ms,ConfigPanel:Ss});function Bs({block:l}){const a=l.config,t=a.label||"Firma",s=a.role||"",r=!!a.required,c=a.width||"half";return e.jsxs("div",{className:`${L[c]} py-1`,children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[t,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border border-gray-200 bg-gray-50/50 p-4 gap-1",children:[e.jsx(X,{className:"h-5 w-5 text-gray-300"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"Firma"}),s&&e.jsx("span",{className:"text-[9px] text-gray-300",children:s})]})]})}function Ds({block:l,onChange:a}){const t=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(h,{value:t.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();a("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Etiqueta"}),e.jsx(h,{value:t.label||"",onChange:s=>a("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Rol"}),e.jsx(h,{value:t.role||"",onChange:s=>a("role",s.target.value),placeholder:"Tecnico PAS, Responsable cliente...",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!t.required,onChange:s=>a("required",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(x,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(I).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(t.width||"half")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>a("width",s),children:r},s))})]})]})}j({definition:v.signature,EditorPreview:Bs,ConfigPanel:Ds});function Ls(){var T;const{modeloId:l,versionId:a}=me(),t=Number(l),s=Number(a),{data:r,isLoading:c}=he(t||void 0,s||void 0),i=ue(t),n=g(p=>p.loadSchema),o=g(p=>p.getSchema),m=g(p=>p.markClean),d=g(p=>p.isDirty),f=g(p=>p.selectBlock),w=g(p=>p.reset),[u,A]=b.useState(!1),[M,q]=b.useState(!1);b.useEffect(()=>{if(r){const p=r.schema||{blocks:[],pageConfig:void 0};n({blocks:p.blocks||[],pageConfig:p.pageConfig||void 0},t,s)}},[r,t,s,n]),b.useEffect(()=>()=>w(),[w]);const S=b.useCallback(async()=>{if(!M){q(!0);try{const p=o();await i.mutateAsync({id:s,schema:p}),m()}catch(p){console.error("Error al guardar:",p)}finally{q(!1)}}},[M,o,i,s,m]);return b.useEffect(()=>{const p=k=>{if((k.ctrlKey||k.metaKey)&&k.key==="s"){k.preventDefault(),d&&S();return}if(k.key==="Escape"){f(null);return}};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[d,S,f]),b.useEffect(()=>{const p=k=>{d&&(k.preventDefault(),k.returnValue="")};return window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)},[d]),c||!r?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"flex h-screen flex-col overflow-hidden",children:[e.jsx(Xe,{modeloNombre:((T=r.modeloComponente)==null?void 0:T.nombre)||"Template",versionNumero:r.version,estado:r.estado,isSaving:M,onSave:S,onOpenPageConfig:()=>A(!0)}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(Qe,{}),e.jsx(es,{}),e.jsx(ss,{})]}),e.jsx(as,{open:u,onOpenChange:A})]})}export{Ls as default};
