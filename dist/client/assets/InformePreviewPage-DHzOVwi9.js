import{c as x,u as f,j as e,L as p,B as l,A as h,a as c,F as u}from"./index-L7yFcTJt.js";import{d as g}from"./useInformes-CF35Jt8c.js";import{h as v,g as j,B as _,F as N}from"./index-DzSgxc3a.js";import{C as b}from"./circle-alert-C3_HrdkD.js";import{E as w}from"./eye-CsJ_ohiK.js";const y={borrador:"bg-gray-100 text-gray-700",finalizado:"bg-amber-100 text-amber-700",entregado:"bg-green-100 text-green-700"},C={borrador:"Borrador",finalizado:"Finalizado",entregado:"Entregado"},L=new Set(["header","section_title","divider","section_separator","cover_header","page_header","page_footer","back_cover","table_of_contents","page_break","content_placeholder","intervention_data","client_data","component_section"]),S=new Set(["header","section_title","divider","section_separator","tristate","checklist","table","equipment_exchange","cover_header","page_header","page_footer","back_cover","table_of_contents","page_break","intervention_data","client_data"]),E={portada:"Portada",intermedia:"Contenido",contraportada:"Contraportada"};function D(){const{id:s}=x(),a=Number(s),r=f(),{data:o,isLoading:n,error:i}=g(a||void 0);if(n)return e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(i||!o)return e.jsxs("div",{className:"flex h-screen flex-col items-center justify-center gap-4",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:(i==null?void 0:i.message)||"No se pudo cargar el informe ensamblado"}),e.jsx(l,{variant:"outline",onClick:()=>r(-1),children:"Volver"})]});const{informe:t,assembled:d,documentTemplate:m}=o;return e.jsxs("div",{className:"flex h-screen flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex h-14 items-center justify-between border-b bg-background px-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>r(`/informes/${a}`),title:"Volver al formulario",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold",children:t.sistema.nombre}),e.jsx(c,{className:"bg-blue-100 text-blue-800",children:m.nombre}),e.jsx(c,{className:y[t.estado]??"bg-gray-100 text-gray-700",children:C[t.estado]??t.estado})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>r(`/informes/${a}`),children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"Formulario"]})})]}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-100",children:e.jsx("div",{className:"py-8 px-4",children:e.jsx(B,{blocks:d.blocks,pageConfig:d.pageConfig})})})]})}function B({blocks:s,pageConfig:a}){const r=a.orientation==="landscape",o=r?1123:794,{margins:n}=a;let i;return e.jsx("div",{className:"mx-auto bg-white shadow-lg",style:{width:o,minHeight:r?794:1123,paddingTop:`${n.top}mm`,paddingRight:`${n.right}mm`,paddingBottom:`${n.bottom}mm`,paddingLeft:`${n.left}mm`,fontFamily:a.fontFamily,fontSize:a.fontSize},children:e.jsx("div",{className:"flex flex-wrap items-start",children:s.map(t=>{const d=[];return t._source==="component"&&t._componenteInformeId!==i&&(i=t._componenteInformeId,d.push(e.jsxs("div",{className:"w-full flex items-center gap-2 py-2 px-1 my-1",children:[e.jsx(v,{className:"h-3.5 w-3.5 text-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:t._componenteEtiqueta}),e.jsx("div",{className:"flex-1 border-t border-blue-200"})]},`comp-sep-${t._componenteInformeId}`))),d.push(e.jsx(A,{block:t},t.id)),d})})})}function A({block:s}){const a=j(s.type);if(!a)return null;if(s.type==="section_separator"){const t=s.config.section;return e.jsx("div",{className:"w-full my-4",children:e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:E[t]??t}),e.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"})]})})}const r=F(s),o=_[s.config.align||"left"];if(L.has(s.type)){const t=a.EditorPreview;return e.jsx("div",{className:`${r} ${o} pointer-events-none`,children:e.jsx(t,{block:s,isSelected:!1})})}const n=a.FormField;if(n&&s._dataKey)return e.jsx("div",{className:`${r} ${o}`,children:e.jsx(n,{block:s,value:s._dataValue??null,onChange:()=>{},readOnly:!0})});const i=a.EditorPreview;return e.jsx("div",{className:`${r} ${o} pointer-events-none`,children:e.jsx(i,{block:s,isSelected:!1})})}function F(s){if(S.has(s.type))return"w-full";const a=s.config.width||"full";return N[a]||"w-full"}export{D as default};
