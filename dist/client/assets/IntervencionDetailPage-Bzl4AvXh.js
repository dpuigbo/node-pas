import{i as w,u as A,m as E,n as P,j as e,B as d,A as B,o as T,a as m,p as z,q as p,s as f,t as N,v,F as D,P as F}from"./index-BsxJzoo8.js";import{u as O,C as S}from"./useInformes-B5dSJQmz.js";const _={borrador:"bg-gray-100 text-gray-700",finalizado:"bg-amber-100 text-amber-700",entregado:"bg-green-100 text-green-700"},k={borrador:"Borrador",finalizado:"Finalizado",entregado:"Entregado"},L={preventiva:"bg-blue-100 text-blue-700",correctiva:"bg-orange-100 text-orange-700"};function G(){var h;const{id:b}=w(),x=Number(b),o=A(),{isAdmin:g}=E(),{data:a,isLoading:y}=P(x||void 0),l=O(x);if(y)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(S,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Intervención no encontrada"}),e.jsx(d,{variant:"outline",onClick:()=>o("/intervenciones"),children:"Volver a intervenciones"})]});const i=a.informes??[],n=a.sistemas??[],C=i.length>0&&i.length>=n.length,I=async()=>{var s,t;try{await l.mutateAsync()}catch(r){const c=((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.error)??"Error al crear informes";alert(c)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>o("/intervenciones"),children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(T,{title:a.titulo,description:`${((h=a.cliente)==null?void 0:h.nombre)??"Sin cliente"}`,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:L[a.tipo]??"bg-gray-100 text-gray-700",children:a.tipo}),e.jsx(m,{variant:"outline",children:a.estado})]})})]}),a.notas&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.notas}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"})," Sistemas (",n.length,")"]}),n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay sistemas asignados a esta intervención."}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:n.map(s=>{var t,r,c,u,j;return e.jsxs(p,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:(t=s.sistema)==null?void 0:t.nombre})}),e.jsx(v,{children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((c=(r=s.sistema)==null?void 0:r.fabricante)==null?void 0:c.nombre)??""," —"," ",((j=(u=s.sistema)==null?void 0:u.componentes)==null?void 0:j.length)??0," componentes"]})})]},s.sistemaId)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"})," Informes (",i.length,")"]}),g&&!C&&n.length>0&&e.jsxs(d,{onClick:I,disabled:l.isPending,size:"sm",children:[e.jsx(F,{className:"mr-1 h-4 w-4"}),l.isPending?"Creando...":"Crear Informes"]})]}),i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:n.length===0?"Asigna sistemas a la intervención primero.":g?'Pulsa "Crear Informes" para generar los informes de cada sistema.':"Todavía no se han generado informes."}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:i.map(s=>{var t;return e.jsxs(p,{className:"cursor-pointer transition-shadow hover:shadow-md",onClick:()=>o(`/informes/${s.id}`),children:[e.jsx(f,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(N,{className:"text-sm font-medium truncate",children:((t=s.sistema)==null?void 0:t.nombre)??`Sistema #${s.sistemaId}`}),e.jsx(m,{className:_[s.estado]??"bg-gray-100 text-gray-700",children:k[s.estado]??s.estado})]})}),e.jsx(v,{children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clic para abrir y rellenar"})})]},s.id)})})]})]})}export{G as default};
