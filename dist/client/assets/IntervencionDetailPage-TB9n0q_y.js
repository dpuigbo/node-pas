import{f as k,c as D,u as P,g as O,w as G,x as T,r as y,j as e,B as m,A as z,P as B,a as f,y as _,z as I,E as w,G as E,H as A,F,m as M,I as H,n as L,o as $,p as R,q as V,X as q,J,K,M as U,N as X,O as Q,t as W}from"./index-CnoWWkNU.js";import{u as Y}from"./useInformes-fhzjKZ1D.js";import{C as Z}from"./circle-alert-Cb2YO-DF.js";import{E as ee}from"./eye-DhfWb2iY.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ae=k("Settings2",se),te={borrador:"bg-gray-100 text-gray-700",finalizado:"bg-amber-100 text-amber-700",entregado:"bg-green-100 text-green-700"},ne={borrador:"Borrador",finalizado:"Finalizado",entregado:"Entregado"},re={preventiva:"bg-blue-100 text-blue-700",correctiva:"bg-orange-100 text-orange-700"};function me(){var p;const{id:N}=D(),h=Number(N),x=P(),{isAdmin:c}=O(),{data:t,isLoading:u}=G(h||void 0),g=Y(h),i=T(),[o,d]=y.useState(!1);if(u)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Intervencion no encontrada"}),e.jsx(m,{variant:"outline",onClick:()=>x("/intervenciones"),children:"Volver a intervenciones"})]});const l=t.informes??[],r=t.sistemas??[],v=l.length>0&&l.length>=r.length,b=async()=>{var s,a;try{await g.mutateAsync()}catch(n){const j=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.error)??"Error al crear informes";alert(j)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>x("/intervenciones"),children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(B,{title:t.titulo,description:`${((p=t.cliente)==null?void 0:p.nombre)??"Sin cliente"}`,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:re[t.tipo]??"bg-gray-100 text-gray-700",children:t.tipo}),e.jsx(f,{variant:"outline",children:t.estado})]})})]}),t.notas&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.notas}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"})," Sistemas (",r.length,")"]}),c&&l.length===0&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),"Gestionar sistemas"]})]}),r.length===0?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["No hay sistemas asignados a esta intervencion.",c&&' Pulsa "Gestionar sistemas" para asignarlos.']}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:r.map(s=>{var a,n,j,C,S;return e.jsxs(I,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium",children:(a=s.sistema)==null?void 0:a.nombre})}),e.jsx(A,{children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((j=(n=s.sistema)==null?void 0:n.fabricante)==null?void 0:j.nombre)??""," â€”"," ",((S=(C=s.sistema)==null?void 0:C.componentes)==null?void 0:S.length)??0," componentes"]})})]},s.sistemaId)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"})," Informes (",l.length,")"]}),c&&!v&&r.length>0&&e.jsxs(m,{onClick:b,disabled:g.isPending,size:"sm",children:[e.jsx(M,{className:"mr-1 h-4 w-4"}),g.isPending?"Creando...":"Crear Informes"]})]}),l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:r.length===0?"Asigna sistemas a la intervencion primero.":c?'Pulsa "Crear Informes" para generar los informes de cada sistema.':"Todavia no se han generado informes."}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:l.map(s=>{var a;return e.jsxs(I,{className:"cursor-pointer transition-shadow hover:shadow-md",onClick:()=>x(`/informes/${s.id}`),children:[e.jsx(w,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(E,{className:"text-sm font-medium truncate",children:((a=s.sistema)==null?void 0:a.nombre)??`Sistema #${s.sistemaId}`}),e.jsx(f,{className:te[s.estado]??"bg-gray-100 text-gray-700",children:ne[s.estado]??s.estado})]})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clic para abrir y rellenar"}),e.jsxs(m,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs gap-1",onClick:n=>{n.stopPropagation(),x(`/informes/${s.id}/preview`)},children:[e.jsx(ee,{className:"h-3 w-3"}),"Preview"]})]})})]},s.id)})})]}),c&&e.jsx(ie,{open:o,onOpenChange:d,intervencion:t,currentSistemaIds:r.map(s=>s.sistemaId),onSave:async s=>{await i.mutateAsync({id:h,sistemaIds:s}),d(!1)},isSaving:i.isPending})]})}function ie({open:N,onOpenChange:h,intervencion:x,currentSistemaIds:c,onSave:t,isSaving:u}){const g=x.clienteId,{data:i}=H(g?{clienteId:g}:void 0),[o,d]=y.useState(c),l=s=>{s&&d(c),h(s)},r=y.useMemo(()=>i?i.filter(s=>!o.includes(s.id)):[],[i,o]),v=s=>{d(a=>[...a,s])},b=s=>{d(a=>a.filter(n=>n!==s))},p=s=>{const a=i==null?void 0:i.find(n=>n.id===s);return(a==null?void 0:a.nombre)??`Sistema #${s}`};return e.jsx(L,{open:N,onOpenChange:l,children:e.jsxs($,{className:"max-w-lg",children:[e.jsx(R,{children:e.jsx(V,{children:"Gestionar sistemas"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecciona los sistemas del cliente que participan en esta intervencion."}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.map(s=>e.jsxs(f,{variant:"secondary",className:"gap-1 pr-1",children:[p(s),e.jsx("button",{type:"button",onClick:()=>b(s),className:"ml-0.5 rounded-full hover:bg-gray-300/50 p-0.5",children:e.jsx(q,{className:"h-3 w-3"})})]},s))}),r.length>0?e.jsxs(J,{value:"",onValueChange:s=>v(Number(s)),children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Anadir sistema..."})}),e.jsx(X,{children:r.map(s=>{var a;return e.jsxs(Q,{value:String(s.id),children:[s.nombre,((a=s.fabricante)==null?void 0:a.nombre)&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",s.fabricante.nombre,")"]})]},s.id)})})]}):o.length>0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todos los sistemas del cliente han sido asignados."}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este cliente no tiene sistemas registrados."})]}),e.jsxs(W,{children:[e.jsx(m,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(m,{onClick:()=>t(o),disabled:u,children:u?"Guardando...":"Guardar"})]})]})})}export{me as default};
