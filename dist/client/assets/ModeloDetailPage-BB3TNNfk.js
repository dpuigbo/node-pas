import{f as P,c as R,u as T,g as U,h as G,i as K,k as X,l as J,m as Q,r,j as e,L as S,B as t,A as W,P as Y,C as Z,n as ee,o as se,p as E,b as ae,X as ne,q as oe,a as x,F as te,s as ie,D as re,t as le,v as ce,w as de,x as me,y as ue,T as xe,z as he,E as ve}from"./index-BYn7hl35.js";import{C as pe}from"./circle-alert-Bd2A6N8c.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],fe=P("Pause",je);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],ge=P("Play",Ne),be={controller:"Controlador",mechanical_unit:"Unidad Mecanica",drive_unit:"Unidad de Accionamiento",external_axis:"Eje Externo"},ye={borrador:"secondary",activo:"default",obsoleto:"outline"},Ce={borrador:"Borrador",activo:"Activo",obsoleto:"Obsoleto"},we=[{value:"1",label:"Nivel 1"},{value:"2_inferior",label:"Nivel 2 Inferior"},{value:"2_superior",label:"Nivel 2 Superior"},{value:"3",label:"Nivel 3"}],ke={1:"N1","2_inferior":"N2 Inf","2_superior":"N2 Sup",3:"N3"};function Ee(){var A;const{modeloId:L}=R(),i=Number(L),l=T(),{isAdmin:c}=U(),{data:o,isLoading:_}=G(i||void 0),{data:D,isLoading:z}=K(i||void 0),h=X(i),g=J(i),v=Q(),[O,d]=r.useState(!1),[b,y]=r.useState(""),[a,p]=r.useState(null),[V,m]=r.useState(!1),[j,f]=r.useState(!1),[u,C]=r.useState([]),B=()=>{const s=o!=null&&o.niveles?o.niveles.split(",").filter(Boolean):[];C(s),f(!0)},I=s=>{C(n=>n.includes(s)?n.filter(H=>H!==s):[...n,s])},M=async()=>{const s=u.length>0?u.join(","):null;await v.mutateAsync({id:i,niveles:s}),f(!1)};if(_)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(!o)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(pe,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Modelo no encontrado"}),e.jsx(t,{variant:"outline",onClick:()=>l(-1),children:"Volver"})]});const w=D??[],k=o.niveles?o.niveles.split(",").filter(Boolean):[],$=async()=>{const s=await h.mutateAsync({schema:{blocks:[],pageConfig:void 0},notas:b||null});d(!1),y("");const n=(s==null?void 0:s.data)??s;n!=null&&n.id&&l(`/modelos/${i}/versiones/${n.id}/editor`)},F=async()=>{if(!a)return;const s=a.estado==="activo"?"obsoleto":"activo";await g.mutateAsync({id:a.id,estado:s}),m(!1),p(null)},q=[{key:"version",header:"Version",render:s=>e.jsxs("span",{className:"font-mono font-medium",children:["v",s.version]})},{key:"estado",header:"Estado",render:s=>e.jsx(x,{variant:ye[s.estado]??"outline",children:Ce[s.estado]??s.estado})},{key:"bloques",header:"Bloques",render:s=>{var N;const n=((N=s.schema)==null?void 0:N.blocks)??[];return e.jsx(x,{variant:"outline",children:n.length})}},{key:"notas",header:"Notas",render:s=>e.jsx("span",{className:"text-sm text-muted-foreground truncate max-w-[200px] block",children:s.notas||"-"})},{key:"updatedAt",header:"Actualizado",render:s=>{const n=new Date(s.updatedAt);return e.jsx("span",{className:"text-sm text-muted-foreground",children:n.toLocaleDateString("es-ES")})}},{key:"acciones",header:"",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(t,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Editar template",onClick:n=>{n.stopPropagation(),l(`/modelos/${i}/versiones/${s.id}/editor`)},children:e.jsx(E,{className:"h-3.5 w-3.5"})}),c&&s.estado!=="activo"&&e.jsx(t,{variant:"ghost",size:"icon",className:"h-7 w-7 text-green-600 hover:text-green-700",title:"Activar version",onClick:n=>{n.stopPropagation(),p(s),m(!0)},children:e.jsx(ge,{className:"h-3.5 w-3.5"})}),c&&s.estado==="activo"&&e.jsx(t,{variant:"ghost",size:"icon",className:"h-7 w-7 text-orange-500 hover:text-orange-600",title:"Marcar como obsoleto",onClick:n=>{n.stopPropagation(),p(s),m(!0)},children:e.jsx(fe,{className:"h-3.5 w-3.5"})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>l(-1),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(Y,{title:o.nombre,description:[(A=o.fabricante)==null?void 0:A.nombre,be[o.tipo]??o.tipo].filter(Boolean).join(" â€” ")})]}),o.notas&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o.notas}),e.jsxs(Z,{children:[e.jsx(ee,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{className:"text-base",children:"Niveles de mantenimiento"}),c&&!j&&e.jsxs(t,{variant:"outline",size:"sm",onClick:B,children:[e.jsx(E,{className:"h-3.5 w-3.5 mr-1"})," Editar"]}),j&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{size:"sm",onClick:M,disabled:v.isPending,children:[e.jsx(ae,{className:"h-3.5 w-3.5 mr-1"}),v.isPending?"Guardando...":"Guardar"]}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>f(!1),children:e.jsx(ne,{className:"h-3.5 w-3.5"})})]})]})}),e.jsx(oe,{children:j?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Selecciona los niveles de mantenimiento aplicables a este modelo."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:we.map(s=>{const n=u.includes(s.value);return e.jsx("button",{type:"button",className:`px-3 py-1.5 text-sm rounded-md border transition-colors ${n?"bg-primary text-primary-foreground border-primary":"bg-background border-input text-muted-foreground hover:bg-muted"}`,onClick:()=>I(s.value),children:s.label},s.value)})}),u.length===0&&e.jsx("p",{className:"text-xs text-orange-500",children:"Sin niveles seleccionados. Este modelo no aparecera en ofertas."})]}):e.jsx("div",{className:"flex flex-wrap gap-1.5",children:k.length>0?k.map(s=>e.jsx(x,{variant:"secondary",children:ke[s]??s},s)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Sin niveles configurados"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"})," Versiones de Template (",w.length,")"]}),c&&e.jsxs(t,{size:"sm",onClick:()=>d(!0),children:[e.jsx(ie,{className:"h-4 w-4"})," Nueva version"]})]}),z?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(S,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx(re,{columns:q,data:w,emptyMessage:"Sin versiones. Crea una nueva version para empezar a disenar el template.",onRowClick:s=>l(`/modelos/${i}/versiones/${s.id}/editor`),rowKey:s=>s.id})]}),e.jsx(le,{open:O,onOpenChange:d,children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsx(me,{children:"Nueva version de template"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Se creara una nueva version en estado ",e.jsx(x,{variant:"secondary",children:"Borrador"})," con un template vacio. Podras editarla en el editor visual."]}),e.jsxs("div",{children:[e.jsx(ue,{children:"Notas (opcional)"}),e.jsx(xe,{value:b,onChange:s=>y(s.target.value),placeholder:"Ej: Version inicial, correccion de campos...",rows:2})]})]}),e.jsxs(he,{children:[e.jsx(t,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(t,{onClick:$,disabled:h.isPending,children:h.isPending?"Creando...":"Crear y abrir editor"})]})]})}),e.jsx(ve,{open:V,onOpenChange:m,title:(a==null?void 0:a.estado)==="activo"?"Marcar como obsoleto":"Activar version",description:(a==null?void 0:a.estado)==="activo"?`La version v${a==null?void 0:a.version} dejara de usarse para nuevos informes.`:`La version v${a==null?void 0:a.version} sera la plantilla activa para nuevos informes. Cualquier otra version activa pasara a obsoleta.`,confirmLabel:(a==null?void 0:a.estado)==="activo"?"Desactivar":"Activar",variant:(a==null?void 0:a.estado)==="activo"?"destructive":"default",onConfirm:F,isLoading:g.isPending})]})}export{Ee as default};
