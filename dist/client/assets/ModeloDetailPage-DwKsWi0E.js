import{f as C,c as V,u as O,g as _,h as z,i as B,k as $,l as M,r as d,j as e,L as y,B as n,A as I,P as q,F,m as R,D as H,n as U,o as K,p as G,q as J,a as h,s as Q,T,t as W,C as X,v as Y}from"./index-cIWNHQUE.js";import{C as Z}from"./circle-alert-Dsp7Oela.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],se=C("Pause",ee);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],oe=C("Play",ae),ne={controller:"Controlador",mechanical_unit:"Unidad Mecanica",drive_unit:"Unidad de Accionamiento",external_axis:"Eje Externo"},te={borrador:"secondary",activo:"default",obsoleto:"outline"},ie={borrador:"Borrador",activo:"Activo",obsoleto:"Obsoleto"};function le(){var g;const{modeloId:b}=V(),t=Number(b),r=O(),{isAdmin:m}=_(),{data:i,isLoading:k}=z(t||void 0),{data:w,isLoading:A}=B(t||void 0),u=$(t),v=M(t),[P,c]=d.useState(!1),[p,j]=d.useState(""),[a,x]=d.useState(null),[L,l]=d.useState(!1);if(k)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(!i)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Modelo no encontrado"}),e.jsx(n,{variant:"outline",onClick:()=>r(-1),children:"Volver"})]});const f=w??[],D=async()=>{const s=await u.mutateAsync({schema:{blocks:[],pageConfig:void 0},notas:p||null});c(!1),j("");const o=(s==null?void 0:s.data)??s;o!=null&&o.id&&r(`/modelos/${t}/versiones/${o.id}/editor`)},E=async()=>{if(!a)return;const s=a.estado==="activo"?"obsoleto":"activo";await v.mutateAsync({id:a.id,estado:s}),l(!1),x(null)},S=[{key:"version",header:"Version",render:s=>e.jsxs("span",{className:"font-mono font-medium",children:["v",s.version]})},{key:"estado",header:"Estado",render:s=>e.jsx(h,{variant:te[s.estado]??"outline",children:ie[s.estado]??s.estado})},{key:"bloques",header:"Bloques",render:s=>{var N;const o=((N=s.schema)==null?void 0:N.blocks)??[];return e.jsx(h,{variant:"outline",children:o.length})}},{key:"notas",header:"Notas",render:s=>e.jsx("span",{className:"text-sm text-muted-foreground truncate max-w-[200px] block",children:s.notas||"-"})},{key:"updatedAt",header:"Actualizado",render:s=>{const o=new Date(s.updatedAt);return e.jsx("span",{className:"text-sm text-muted-foreground",children:o.toLocaleDateString("es-ES")})}},{key:"acciones",header:"",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Editar template",onClick:o=>{o.stopPropagation(),r(`/modelos/${t}/versiones/${s.id}/editor`)},children:e.jsx(Y,{className:"h-3.5 w-3.5"})}),m&&s.estado!=="activo"&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7 text-green-600 hover:text-green-700",title:"Activar version",onClick:o=>{o.stopPropagation(),x(s),l(!0)},children:e.jsx(oe,{className:"h-3.5 w-3.5"})}),m&&s.estado==="activo"&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-7 w-7 text-orange-500 hover:text-orange-600",title:"Marcar como obsoleto",onClick:o=>{o.stopPropagation(),x(s),l(!0)},children:e.jsx(se,{className:"h-3.5 w-3.5"})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>r(-1),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(q,{title:i.nombre,description:[(g=i.fabricante)==null?void 0:g.nombre,ne[i.tipo]??i.tipo].filter(Boolean).join(" â€” ")})]}),i.notas&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.notas}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"})," Versiones de Template (",f.length,")"]}),m&&e.jsxs(n,{size:"sm",onClick:()=>c(!0),children:[e.jsx(R,{className:"h-4 w-4"})," Nueva version"]})]}),A?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx(H,{columns:S,data:f,emptyMessage:"Sin versiones. Crea una nueva version para empezar a disenar el template.",onRowClick:s=>r(`/modelos/${t}/versiones/${s.id}/editor`),rowKey:s=>s.id})]}),e.jsx(U,{open:P,onOpenChange:c,children:e.jsxs(K,{children:[e.jsx(G,{children:e.jsx(J,{children:"Nueva version de template"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Se creara una nueva version en estado ",e.jsx(h,{variant:"secondary",children:"Borrador"})," con un template vacio. Podras editarla en el editor visual."]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Notas (opcional)"}),e.jsx(T,{value:p,onChange:s=>j(s.target.value),placeholder:"Ej: Version inicial, correccion de campos...",rows:2})]})]}),e.jsxs(W,{children:[e.jsx(n,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(n,{onClick:D,disabled:u.isPending,children:u.isPending?"Creando...":"Crear y abrir editor"})]})]})}),e.jsx(X,{open:L,onOpenChange:l,title:(a==null?void 0:a.estado)==="activo"?"Marcar como obsoleto":"Activar version",description:(a==null?void 0:a.estado)==="activo"?`La version v${a==null?void 0:a.version} dejara de usarse para nuevos informes.`:`La version v${a==null?void 0:a.version} sera la plantilla activa para nuevos informes. Cualquier otra version activa pasara a obsoleta.`,confirmLabel:(a==null?void 0:a.estado)==="activo"?"Desactivar":"Activar",variant:(a==null?void 0:a.estado)==="activo"?"destructive":"default",onConfirm:E,isLoading:v.isPending})]})}export{le as default};
