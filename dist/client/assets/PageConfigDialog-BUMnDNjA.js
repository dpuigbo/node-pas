import{f as v,a2 as N,j as s,a3 as F,F as q,a4 as j,r as b,$ as z,B as M,X as V,n as G,o as U,p as Y,q as K,s as S,_ as H}from"./index-JklgQlWn.js";import{D,b as C,a as X,P as J,I as Q,A as Z,C as ee,c as te,g as L,B as se,F as ne}from"./index-DAWNeC5x.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ce=v("ArrowDown",oe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],ie=v("ArrowUp",re);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],le=v("CircleCheckBig",ae);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],R=v("Copy",de);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],pe=v("GripVertical",ue);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ge=v("Hash",he);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M6 20V4",key:"1w1bmo"}],["path",{d:"M18 20V4",key:"o2hl4u"}]],xe=v("Heading",fe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],ye=v("ListChecks",me);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M5 12h14",key:"1ays0h"}]],be=v("Minus",ke);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],je=v("Table",ve);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]],Ne=v("Type",we),P=e=>{let r;const o=new Set,c=(p,u)=>{const h=typeof p=="function"?p(r):p;if(!Object.is(h,r)){const m=r;r=u??(typeof h!="object"||h===null)?h:Object.assign({},r,h),o.forEach(y=>y(r,m))}},n=()=>r,i={setState:c,getState:n,getInitialState:()=>l,subscribe:p=>(o.add(p),()=>o.delete(p))},l=r=e(c,n,i);return i},Be=(e=>e?P(e):P),Ce=e=>e;function Ie(e,r=Ce){const o=N.useSyncExternalStore(e.subscribe,N.useCallback(()=>r(e.getState()),[e,r]),N.useCallback(()=>r(e.getInitialState()),[e,r]));return N.useDebugValue(o),o}const $=e=>{const r=Be(e),o=c=>Ie(r,c);return Object.assign(o,r),o},_e=(e=>e?$(e):$);function Me(e,r,o){const c={...e},n=r.split(".");let t=c;for(let i=0;i<n.length-1;i++){const l=n[i],p=n[i+1],u=p!=null&&/^\d+$/.test(p);Array.isArray(t[l])?t[l]=[...t[l]]:typeof t[l]=="object"&&t[l]!==null?t[l]={...t[l]}:t[l]=u?[]:{},t=t[l]}const a=n[n.length-1];return a!=null&&(t[a]=o),c}function A(e,r){const o=e.replace(/_/g,"_"),c=r.filter(t=>t.type===e).map(t=>{const i=(t.config.key||"").match(new RegExp(`^${o}_(\\d+)$`));return(i==null?void 0:i[1])!=null?parseInt(i[1],10):0}),n=c.length>0?Math.max(...c):0;return`${o}_${n+1}`}function E(){return crypto.randomUUID()}const T=["portada","intermedia","contraportada"];function Se(e){const o=e.filter(t=>t.type==="section_separator").map(t=>t.config.section);if(T.every(t=>o.includes(t)))return e;const c=e.filter(t=>t.type!=="section_separator"),n=[];for(const t of T)n.push({id:`section-${t}`,type:"section_separator",config:{section:t}});return c.length>0&&n.splice(1,0,...c),n}const f=_e((e,r)=>({blocks:[],pageConfig:{...D},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,isDocumentTemplate:!1,blockHeights:new Map,loadSchema:(o,c,n,t=!1)=>{let a=o.blocks||[];t&&(a=Se(a)),e({blocks:a,pageConfig:o.pageConfig||{...D},selectedBlockId:null,isDirty:!1,versionId:n,modeloId:c,isDocumentTemplate:t,blockHeights:new Map})},addBlock:(o,c)=>{const n=C[o];if(!n)return;const{blocks:t}=r(),a={...n.defaultConfig};n.hasData&&(a.key=A(o,t));const i={id:E(),type:o,config:a},l=[...t];c!==void 0&&c>=0&&c<=t.length?l.splice(c,0,i):l.push(i),e({blocks:l,isDirty:!0,selectedBlockId:i.id})},removeBlock:o=>{const{blocks:c,selectedBlockId:n}=r(),t=c.find(i=>i.id===o);if((t==null?void 0:t.type)==="section_separator")return;const a=new Map(r().blockHeights);a.delete(o),e({blocks:c.filter(i=>i.id!==o),isDirty:!0,selectedBlockId:n===o?null:n,blockHeights:a})},duplicateBlock:o=>{const{blocks:c}=r(),n=c.findIndex(u=>u.id===o);if(n===-1)return;const t=c[n];if(t.type==="section_separator")return;const a=C[t.type],i=JSON.parse(JSON.stringify(t.config));a!=null&&a.hasData&&i.key&&(i.key=A(t.type,c));const l={id:E(),type:t.type,config:i},p=[...c];p.splice(n+1,0,l),e({blocks:p,isDirty:!0,selectedBlockId:l.id})},moveBlock:(o,c)=>{const{blocks:n}=r(),t=n.findIndex(h=>h.id===o);if(t===-1||n[t].type==="section_separator")return;const i=c==="up"?t-1:t+1;if(i<0||i>=n.length||n[i].type==="section_separator")return;const l=[...n],p=l[t],u=l[i];l[t]=u,l[i]=p,e({blocks:l,isDirty:!0})},reorderBlocks:o=>{const{blocks:c}=r(),n=new Map(c.map(i=>[i.id,i])),t=o.map(i=>n.get(i)).filter(Boolean),a=c.filter(i=>!o.includes(i.id));e({blocks:[...t,...a],isDirty:!0})},updateBlockConfig:(o,c,n)=>{const{blocks:t}=r();e({blocks:t.map(a=>a.id===o?{...a,config:Me(a.config,c,n)}:a),isDirty:!0})},selectBlock:o=>{e({selectedBlockId:o})},updatePageConfig:o=>{const{pageConfig:c}=r();e({pageConfig:{...c,...o},isDirty:!0})},setBlockHeight:(o,c)=>{const{blockHeights:n}=r();if(n.get(o)===c)return;const t=new Map(n);t.set(o,c),e({blockHeights:t})},getSchema:()=>{const{blocks:o,pageConfig:c}=r();return{blocks:o,pageConfig:c}},markClean:()=>{e({isDirty:!1})},reset:()=>{e({blocks:[],pageConfig:{...D},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,isDocumentTemplate:!1,blockHeights:new Map})}})),De={FileText:q,Heading:xe,Minus:be,Type:Ne,Hash:ge,Calendar:ee,AlignLeft:Z,ChevronDown:F,CheckCircle:le,ListChecks:ye,Table:je,Image:Q,Pen:J};function qe(){const e=f(r=>r.addBlock);return s.jsxs("div",{className:"flex w-56 flex-col border-r bg-background overflow-y-auto",children:[s.jsx("div",{className:"px-4 py-3 border-b",children:s.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Bloques"})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-4",children:X.map(r=>{const o=r.types.filter(c=>c!=="section_separator");return o.length===0?null:s.jsxs("div",{children:[s.jsx("p",{className:"px-2 pb-1 text-xs font-medium text-muted-foreground uppercase tracking-wide",children:r.label}),s.jsx("div",{className:"space-y-0.5",children:o.map(c=>{const n=C[c],t=De[n.icon];return s.jsxs("button",{onClick:()=>e(c),className:j("flex w-full items-center gap-2 rounded-md px-2 py-2 text-sm","hover:bg-accent hover:text-accent-foreground transition-colors","cursor-pointer select-none"),title:`Anadir ${n.label}`,children:[t&&s.jsx(t,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),s.jsx("span",{className:"truncate",children:n.label})]},c)})})]},r.id)})})]})}const He=794,Pe=1123,$e=3.78,Ae=new Set(["header","section_title","divider","tristate","checklist","table","section_separator"]);function Ee(e){if(Ae.has(e.type))return 1;const r=e.config.width||"full";return te[r]??1}function Te({blocks:e,pageConfig:r,blockHeights:o}){return b.useMemo(()=>{if(e.length===0)return{pages:[{pageIndex:0,blockIds:[]}],totalPages:1};const t=(r.orientation==="portrait"?Pe:He)-(r.margins.top+r.margins.bottom)*$e,a=[];let i={pageIndex:0,blockIds:[]},l=0,p=0,u=0,h=[];const m=()=>{h.length!==0&&(l+u>t&&i.blockIds.length>0&&(a.push(i),i={pageIndex:a.length,blockIds:[]},l=0),i.blockIds.push(...h),l+=u,p=0,u=0,h=[])};for(const y of e){if(y.type==="section_separator"){m(),i.blockIds.length>0&&(a.push(i),i={pageIndex:a.length,blockIds:[]},l=0),i.blockIds.push(y.id);const k=o.get(y.id)||40;l+=k;continue}const d=Ee(y),x=o.get(y.id)||30;p+d>1.01&&h.length>0&&m(),h.push(y.id),p+=d,u=Math.max(u,x),d>=1&&m()}return m(),(i.blockIds.length>0||a.length===0)&&a.push(i),{pages:a,totalPages:a.length}},[e,r,o])}const I=794,_=1123,B=3.78,ze=new Set(["header","section_title","divider","tristate","checklist","table","section_separator"]);function Le(e){if(ze.has(e.type))return"w-full";const r=e.config.width||"full";return ne[r]||"w-full"}function Re({block:e,index:r,totalBlocks:o,onHeightChange:c}){const n=f(g=>g.selectedBlockId),t=f(g=>g.selectBlock),a=f(g=>g.removeBlock),i=f(g=>g.duplicateBlock),l=f(g=>g.moveBlock),p=n===e.id,u=e.type==="section_separator",h=L(e.type),m=Le(e),y=m==="w-full",[d,x]=b.useState(!1),k=b.useRef(null);if(b.useEffect(()=>{if(!k.current)return;const g=new ResizeObserver(O=>{for(const W of O)c(e.id,W.contentRect.height)});return g.observe(k.current),()=>g.disconnect()},[e.id,c]),!h)return s.jsx("div",{ref:k,className:j(m,"p-0.5"),children:s.jsxs("div",{className:"rounded border border-dashed border-destructive bg-destructive/5 p-4 text-sm text-destructive",children:["Bloque desconocido: ",e.type]})});const w=h.EditorPreview;return u?s.jsx("div",{ref:k,className:j("w-full cursor-pointer rounded-sm transition-all",p&&"ring-2 ring-primary ring-offset-1"),onClick:g=>{g.stopPropagation(),t(e.id)},children:s.jsx(w,{block:e,isSelected:p})}):s.jsx("div",{ref:k,className:j(m,"relative group"),style:{padding:"1px"},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:s.jsxs("div",{className:j("relative rounded-sm transition-all cursor-pointer",p&&"ring-2 ring-primary ring-offset-1",!p&&d&&"ring-1 ring-primary/30"),onClick:g=>{g.stopPropagation(),t(e.id)},children:[(d||p)&&s.jsxs("div",{className:j("absolute z-20 flex items-center gap-0.5 rounded-md border bg-background/95 shadow-sm backdrop-blur-sm px-1 py-0.5",y?"-top-7 right-2":"-top-7 left-1/2 -translate-x-1/2"),onClick:g=>g.stopPropagation(),children:[s.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground disabled:opacity-30",onClick:()=>l(e.id,"up"),disabled:r===0,title:"Mover arriba",children:s.jsx(ie,{className:"h-3 w-3"})}),s.jsx("button",{className:"rounded p-1 text-muted-foreground cursor-grab",title:"Arrastrar",children:s.jsx(pe,{className:"h-3 w-3"})}),s.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground disabled:opacity-30",onClick:()=>l(e.id,"down"),disabled:r===o-1,title:"Mover abajo",children:s.jsx(ce,{className:"h-3 w-3"})}),s.jsx("div",{className:"w-px h-4 bg-border mx-0.5"}),s.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground",onClick:()=>i(e.id),title:"Duplicar",children:s.jsx(R,{className:"h-3 w-3"})}),s.jsx("button",{className:"rounded p-1 hover:bg-destructive/10 text-destructive",onClick:()=>a(e.id),title:"Eliminar",children:s.jsx(z,{className:"h-3 w-3"})})]}),s.jsx("div",{className:se[e.config.align||"left"],children:s.jsx(w,{block:e,isSelected:p})})]})})}function Oe({pageIndex:e,totalPages:r,blockIds:o,allBlocks:c,pageConfig:n,scale:t,onBlockHeightChange:a}){const i=f(d=>d.selectBlock),l=c.length,p=n.orientation==="portrait",u=p?I:_,h=p?_:I,m=b.useMemo(()=>{const d=new Map(c.map(x=>[x.id,x]));return o.map(x=>d.get(x)).filter(Boolean)},[o,c]),y=b.useMemo(()=>{const d=new Map;return c.forEach((x,k)=>d.set(x.id,k)),d},[c]);return s.jsxs("div",{className:"bg-white shadow-lg border relative shrink-0",style:{width:u,height:h,transform:`scale(${t})`,transformOrigin:"top center",padding:`${n.margins.top*B}px ${n.margins.right*B}px ${n.margins.bottom*B}px ${n.margins.left*B}px`,fontSize:`${n.fontSize}px`},onClick:d=>{d.stopPropagation(),i(null)},children:[m.length===0&&e===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground/50",children:[s.jsx("p",{className:"text-lg font-medium",children:"Canvas vacio"}),s.jsx("p",{className:"text-sm mt-1",children:"Haz clic en un bloque de la paleta para empezar"})]}):s.jsx("div",{className:"flex flex-wrap items-start content-start overflow-hidden",children:m.map(d=>{const x=y.get(d.id)??0;return s.jsx(Re,{block:d,index:x,totalBlocks:l,onHeightChange:a},d.id)})}),s.jsxs("div",{className:"absolute bottom-2 right-4 text-[10px] text-gray-300 pointer-events-none",children:["Pagina ",e+1," / ",r]})]})}function Ve(){const e=f(d=>d.blocks),r=f(d=>d.pageConfig),o=f(d=>d.selectBlock),c=f(d=>d.blockHeights),n=f(d=>d.setBlockHeight),t=b.useRef(null),[a,i]=b.useState(1),l=b.useCallback((d,x)=>{const k=a>0?Math.round(x/a):x;n(d,k)},[a,n]),p=b.useCallback(()=>{if(!t.current)return;const d=t.current.clientWidth,k=r.orientation==="portrait"?I:_,w=d-80,g=Math.min(w/k,1);i(g)},[r.orientation]);b.useEffect(()=>{p();const d=new ResizeObserver(p);return t.current&&d.observe(t.current),()=>d.disconnect()},[p]);const{pages:u,totalPages:h}=Te({blocks:e,pageConfig:r,blockHeights:c}),y=r.orientation==="portrait"?_:I;return s.jsx("div",{ref:t,className:"flex-1 overflow-y-auto bg-muted/40 p-8",onClick:()=>o(null),children:s.jsx("div",{className:"flex flex-col items-center",style:{gap:`${Math.max(24*a,12)}px`},children:u.map(d=>s.jsx("div",{style:{height:y*a,width:"100%",display:"flex",justifyContent:"center"},children:s.jsx(Oe,{pageIndex:d.pageIndex,totalPages:h,blockIds:d.blockIds,allBlocks:e,pageConfig:r,scale:a,onBlockHeightChange:l})},d.pageIndex))})})}function Ge(){const e=f(u=>u.selectedBlockId),r=f(u=>u.blocks),o=f(u=>u.selectBlock),c=f(u=>u.updateBlockConfig),n=f(u=>u.duplicateBlock),t=f(u=>u.removeBlock);if(!e)return s.jsx("div",{className:"flex w-80 flex-col border-l bg-background",children:s.jsx("div",{className:"flex flex-1 items-center justify-center p-4 text-sm text-muted-foreground",children:"Selecciona un bloque para configurarlo"})});const a=r.find(u=>u.id===e);if(!a)return null;const i=L(a.type),l=C[a.type];if(!i||!l)return null;const p=i.ConfigPanel;return s.jsxs("div",{className:"flex w-80 flex-col border-l bg-background",children:[s.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-sm font-semibold",children:l.label})}),s.jsx(M,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>o(null),children:s.jsx(V,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s.jsx(p,{block:a,onChange:(u,h)=>c(a.id,u,h)})}),a.type!=="section_separator"&&s.jsxs("div",{className:"flex items-center gap-2 border-t px-4 py-3",children:[s.jsxs(M,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>n(a.id),children:[s.jsx(R,{className:"h-4 w-4 mr-1"}),"Duplicar"]}),s.jsxs(M,{variant:"outline",size:"sm",className:"flex-1 text-destructive hover:bg-destructive/10",onClick:()=>{t(a.id)},children:[s.jsx(z,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})}function Ue({open:e,onOpenChange:r}){const o=f(n=>n.pageConfig),c=f(n=>n.updatePageConfig);return s.jsx(G,{open:e,onOpenChange:r,children:s.jsxs(U,{className:"sm:max-w-md",children:[s.jsx(Y,{children:s.jsx(K,{children:"Configuracion de pagina"})}),s.jsxs("div",{className:"space-y-4 py-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Orientacion"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${o.orientation==="portrait"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>c({orientation:"portrait"}),children:"Vertical"}),s.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${o.orientation==="landscape"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>c({orientation:"landscape"}),children:"Horizontal"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Margenes (mm)"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:["top","right","bottom","left"].map(n=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-muted-foreground w-16 capitalize",children:n==="top"?"Arriba":n==="right"?"Derecha":n==="bottom"?"Abajo":"Izquierda"}),s.jsx(H,{type:"number",min:5,max:50,value:o.margins[n],onChange:t=>c({margins:{...o.margins,[n]:Math.max(5,Math.min(50,Number(t.target.value)||5))}}),className:"h-8 w-full"})]},n))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Tamano de fuente base (px)"}),s.jsx(H,{type:"number",min:8,max:14,value:o.fontSize,onChange:n=>c({fontSize:Math.max(8,Math.min(14,Number(n.target.value)||10))}),className:"h-8"})]})]})]})})}export{qe as B,Ge as C,Ve as E,Ue as P,f as u};
