import{f as h,a2 as b,j as e,a3 as P,F as H,a4 as g,r as y,$,B as j,X as L,n as T,o as W,p as q,q as O,s as N,_ as B}from"./index-BCa5M7_f.js";import{D as C,b as v,a as F,P as V,I as G,A as R,C as U,g as A,B as K,F as J}from"./index-DZtK-Syx.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],X=h("ArrowDown",Y);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Z=h("ArrowUp",Q);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],te=h("CircleCheckBig",ee);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],z=h("Copy",se);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],oe=h("GripVertical",ne);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],re=h("Hash",ce);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M6 20V4",key:"1w1bmo"}],["path",{d:"M18 20V4",key:"o2hl4u"}]],ie=h("Heading",ae);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],de=h("ListChecks",le);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M5 12h14",key:"1ays0h"}]],pe=h("Minus",ue);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],me=h("Table",xe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]],fe=h("Type",he),I=t=>{let c;const s=new Set,n=(u,i)=>{const x=typeof u=="function"?u(c):u;if(!Object.is(x,c)){const f=c;c=i??(typeof x!="object"||x===null)?x:Object.assign({},c,x),s.forEach(k=>k(c,f))}},o=()=>c,a={setState:n,getState:o,getInitialState:()=>d,subscribe:u=>(s.add(u),()=>s.delete(u))},d=c=t(n,o,a);return a},ge=(t=>t?I(t):I),ye=t=>t;function ke(t,c=ye){const s=b.useSyncExternalStore(t.subscribe,b.useCallback(()=>c(t.getState()),[t,c]),b.useCallback(()=>c(t.getInitialState()),[t,c]));return b.useDebugValue(s),s}const _=t=>{const c=ge(t),s=n=>ke(c,n);return Object.assign(s,c),s},be=(t=>t?_(t):_);function ve(t,c,s){const n={...t},o=c.split(".");let r=n;for(let a=0;a<o.length-1;a++){const d=o[a],u=o[a+1],i=u!=null&&/^\d+$/.test(u);Array.isArray(r[d])?r[d]=[...r[d]]:typeof r[d]=="object"&&r[d]!==null?r[d]={...r[d]}:r[d]=i?[]:{},r=r[d]}const l=o[o.length-1];return l!=null&&(r[l]=s),n}function S(t,c){const s=t.replace(/_/g,"_"),n=c.filter(r=>r.type===t).map(r=>{const a=(r.config.key||"").match(new RegExp(`^${s}_(\\d+)$`));return(a==null?void 0:a[1])!=null?parseInt(a[1],10):0}),o=n.length>0?Math.max(...n):0;return`${s}_${o+1}`}function D(){return crypto.randomUUID()}const p=be((t,c)=>({blocks:[],pageConfig:{...C},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,loadSchema:(s,n,o)=>{t({blocks:s.blocks||[],pageConfig:s.pageConfig||{...C},selectedBlockId:null,isDirty:!1,versionId:o,modeloId:n})},addBlock:(s,n)=>{const o=v[s];if(!o)return;const{blocks:r}=c(),l={...o.defaultConfig};o.hasData&&(l.key=S(s,r));const a={id:D(),type:s,config:l},d=[...r];n!==void 0&&n>=0&&n<=r.length?d.splice(n,0,a):d.push(a),t({blocks:d,isDirty:!0,selectedBlockId:a.id})},removeBlock:s=>{const{blocks:n,selectedBlockId:o}=c();t({blocks:n.filter(r=>r.id!==s),isDirty:!0,selectedBlockId:o===s?null:o})},duplicateBlock:s=>{const{blocks:n}=c(),o=n.findIndex(i=>i.id===s);if(o===-1)return;const r=n[o],l=v[r.type],a=JSON.parse(JSON.stringify(r.config));l!=null&&l.hasData&&a.key&&(a.key=S(r.type,n));const d={id:D(),type:r.type,config:a},u=[...n];u.splice(o+1,0,d),t({blocks:u,isDirty:!0,selectedBlockId:d.id})},moveBlock:(s,n)=>{const{blocks:o}=c(),r=o.findIndex(i=>i.id===s);if(r===-1)return;const l=n==="up"?r-1:r+1;if(l<0||l>=o.length)return;const a=[...o],d=a[r],u=a[l];a[r]=u,a[l]=d,t({blocks:a,isDirty:!0})},reorderBlocks:s=>{const{blocks:n}=c(),o=new Map(n.map(a=>[a.id,a])),r=s.map(a=>o.get(a)).filter(Boolean),l=n.filter(a=>!s.includes(a.id));t({blocks:[...r,...l],isDirty:!0})},updateBlockConfig:(s,n,o)=>{const{blocks:r}=c();t({blocks:r.map(l=>l.id===s?{...l,config:ve(l.config,n,o)}:l),isDirty:!0})},selectBlock:s=>{t({selectedBlockId:s})},updatePageConfig:s=>{const{pageConfig:n}=c();t({pageConfig:{...n,...s},isDirty:!0})},getSchema:()=>{const{blocks:s,pageConfig:n}=c();return{blocks:s,pageConfig:n}},markClean:()=>{t({isDirty:!1})},reset:()=>{t({blocks:[],pageConfig:{...C},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null})}})),je={FileText:H,Heading:ie,Minus:pe,Type:fe,Hash:re,Calendar:U,AlignLeft:R,ChevronDown:P,CheckCircle:te,ListChecks:de,Table:me,Image:G,Pen:V};function _e(){const t=p(c=>c.addBlock);return e.jsxs("div",{className:"flex w-56 flex-col border-r bg-background overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 border-b",children:e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Bloques"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-4",children:F.map(c=>e.jsxs("div",{children:[e.jsx("p",{className:"px-2 pb-1 text-xs font-medium text-muted-foreground uppercase tracking-wide",children:c.label}),e.jsx("div",{className:"space-y-0.5",children:c.types.map(s=>{const n=v[s],o=je[n.icon];return e.jsxs("button",{onClick:()=>t(s),className:g("flex w-full items-center gap-2 rounded-md px-2 py-2 text-sm","hover:bg-accent hover:text-accent-foreground transition-colors","cursor-pointer select-none"),title:`Anadir ${n.label}`,children:[o&&e.jsx(o,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:n.label})]},s)})})]},c.id))})]})}const w=794,M=1123,Ne=new Set(["header","section_title","divider","tristate","checklist","table"]);function Ce(t){if(Ne.has(t.type))return"w-full";const c=t.config.width||"full";return J[c]||"w-full"}function we({block:t,index:c,totalBlocks:s}){const n=p(m=>m.selectedBlockId),o=p(m=>m.selectBlock),r=p(m=>m.removeBlock),l=p(m=>m.duplicateBlock),a=p(m=>m.moveBlock),d=n===t.id,u=A(t.type),i=Ce(t),x=i==="w-full",[f,k]=y.useState(!1);if(!u)return e.jsx("div",{className:g(i,"p-0.5"),children:e.jsxs("div",{className:"rounded border border-dashed border-destructive bg-destructive/5 p-4 text-sm text-destructive",children:["Bloque desconocido: ",t.type]})});const E=u.EditorPreview;return e.jsx("div",{className:g(i,"relative group"),style:{padding:"1px"},onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:e.jsxs("div",{className:g("relative rounded-sm transition-all cursor-pointer",d&&"ring-2 ring-primary ring-offset-1",!d&&f&&"ring-1 ring-primary/30"),onClick:m=>{m.stopPropagation(),o(t.id)},children:[(f||d)&&e.jsxs("div",{className:g("absolute z-20 flex items-center gap-0.5 rounded-md border bg-background/95 shadow-sm backdrop-blur-sm px-1 py-0.5",x?"-top-7 right-2":"-top-7 left-1/2 -translate-x-1/2"),onClick:m=>m.stopPropagation(),children:[e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground disabled:opacity-30",onClick:()=>a(t.id,"up"),disabled:c===0,title:"Mover arriba",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx("button",{className:"rounded p-1 text-muted-foreground cursor-grab",title:"Arrastrar",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground disabled:opacity-30",onClick:()=>a(t.id,"down"),disabled:c===s-1,title:"Mover abajo",children:e.jsx(X,{className:"h-3 w-3"})}),e.jsx("div",{className:"w-px h-4 bg-border mx-0.5"}),e.jsx("button",{className:"rounded p-1 hover:bg-accent text-muted-foreground",onClick:()=>l(t.id),title:"Duplicar",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx("button",{className:"rounded p-1 hover:bg-destructive/10 text-destructive",onClick:()=>r(t.id),title:"Eliminar",children:e.jsx($,{className:"h-3 w-3"})})]}),e.jsx("div",{className:K[t.config.align||"left"],children:e.jsx(E,{block:t,isSelected:d})})]})})}function Se(){const t=p(i=>i.blocks),c=p(i=>i.pageConfig),s=p(i=>i.selectBlock),n=y.useRef(null),[o,r]=y.useState(1),l=y.useCallback(()=>{if(!n.current)return;const x=n.current.clientWidth-80,f=Math.min(x/w,1);r(f)},[]);y.useEffect(()=>{l();const i=new ResizeObserver(l);return n.current&&i.observe(n.current),()=>i.disconnect()},[l]);const a=c.orientation==="portrait",d=a?w:M,u=a?M:w;return e.jsx("div",{ref:n,className:"flex-1 overflow-y-auto bg-muted/40 p-8",onClick:()=>s(null),children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-white shadow-lg border relative",style:{width:d,minHeight:u,transform:`scale(${o})`,transformOrigin:"top center",marginBottom:`${(u*o-u)*-1}px`,padding:`${c.margins.top*3.78}px ${c.margins.right*3.78}px ${c.margins.bottom*3.78}px ${c.margins.left*3.78}px`,fontSize:`${c.fontSize}px`},children:[e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-200 pointer-events-none z-20",style:{top:u},children:e.jsx("span",{className:"absolute right-2 -top-4 text-[10px] text-red-300 bg-white px-1",children:"Corte de pagina"})}),t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-muted-foreground/50",children:[e.jsx("p",{className:"text-lg font-medium",children:"Canvas vacio"}),e.jsx("p",{className:"text-sm mt-1",children:"Haz clic en un bloque de la paleta para empezar"})]}):e.jsx("div",{className:"flex flex-wrap items-start pt-2",children:t.map((i,x)=>e.jsx(we,{block:i,index:x,totalBlocks:t.length},i.id))})]})})})}function De(){const t=p(i=>i.selectedBlockId),c=p(i=>i.blocks),s=p(i=>i.selectBlock),n=p(i=>i.updateBlockConfig),o=p(i=>i.duplicateBlock),r=p(i=>i.removeBlock);if(!t)return e.jsx("div",{className:"flex w-80 flex-col border-l bg-background",children:e.jsx("div",{className:"flex flex-1 items-center justify-center p-4 text-sm text-muted-foreground",children:"Selecciona un bloque para configurarlo"})});const l=c.find(i=>i.id===t);if(!l)return null;const a=A(l.type),d=v[l.type];if(!a||!d)return null;const u=a.ConfigPanel;return e.jsxs("div",{className:"flex w-80 flex-col border-l bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm font-semibold",children:d.label})}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>s(null),children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(u,{block:l,onChange:(i,x)=>n(l.id,i,x)})}),e.jsxs("div",{className:"flex items-center gap-2 border-t px-4 py-3",children:[e.jsxs(j,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>o(l.id),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Duplicar"]}),e.jsxs(j,{variant:"outline",size:"sm",className:"flex-1 text-destructive hover:bg-destructive/10",onClick:()=>{r(l.id)},children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})}function Me({open:t,onOpenChange:c}){const s=p(o=>o.pageConfig),n=p(o=>o.updatePageConfig);return e.jsx(T,{open:t,onOpenChange:c,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsx(q,{children:e.jsx(O,{children:"Configuracion de pagina"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Orientacion"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${s.orientation==="portrait"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>n({orientation:"portrait"}),children:"Vertical"}),e.jsx("button",{className:`flex-1 rounded-md border px-3 py-2 text-sm ${s.orientation==="landscape"?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>n({orientation:"landscape"}),children:"Horizontal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Margenes (mm)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["top","right","bottom","left"].map(o=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-16 capitalize",children:o==="top"?"Arriba":o==="right"?"Derecha":o==="bottom"?"Abajo":"Izquierda"}),e.jsx(B,{type:"number",min:5,max:50,value:s.margins[o],onChange:r=>n({margins:{...s.margins,[o]:Math.max(5,Math.min(50,Number(r.target.value)||5))}}),className:"h-8 w-full"})]},o))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Tamano de fuente base (px)"}),e.jsx(B,{type:"number",min:8,max:14,value:s.fontSize,onChange:o=>n({fontSize:Math.max(8,Math.min(14,Number(o.target.value)||10))}),className:"h-8"})]})]})]})})}export{_e as B,De as C,Se as E,Me as P,p as u};
