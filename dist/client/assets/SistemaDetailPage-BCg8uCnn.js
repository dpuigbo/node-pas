import{H as y,I as N,J as b,c as Q,u as K,g as O,a2 as V,r as f,a3 as H,j as e,B as d,A as R,P as G,a4 as J,s as W,D as Z,t as X,v as Y,w as ee,x as ne,y as p,Z as P,_ as k,$ as A,a0 as D,a1 as x,Q as S,z as te,a as se,p as ae,W as oe}from"./index-BNvUY6eH.js";import{C as ie}from"./circle-alert-sdRDdISn.js";function re(a){const o=y();return N({mutationFn:i=>b.post(`/v1/sistemas/${a}/componentes`,i),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}function le(a){const o=y();return N({mutationFn:({id:i,...h})=>b.put(`/v1/sistemas/${a}/componentes/${i}`,h),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}function ce(a){const o=y();return N({mutationFn:i=>b.delete(`/v1/sistemas/${a}/componentes/${i}`),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}const de={controller:"Controlador",mechanical_unit:"Unidad mecanica",drive_unit:"Unidad de accionamiento",external_axis:"Eje externo"};function pe(){var q,w,I;const{id:a}=Q(),o=Number(a),i=K(),{isAdmin:h}=O(),{data:s,isLoading:_}=V(o||void 0),C=re(o),g=le(o),F=ce(o),[T,m]=f.useState(!1),[r,E]=f.useState(null),[t,c]=f.useState({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),{data:u}=H(s!=null&&s.fabricanteId?{fabricanteId:s.fabricanteId,tipo:t.tipo||void 0}:void 0);if(_)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(ie,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Sistema no encontrado"}),e.jsx(d,{variant:"outline",onClick:()=>i(-1),children:"Volver"})]});const v=s.componentes??[],j=()=>{c({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),E(null)},$=()=>{j(),m(!0)},M=n=>{E(n),c({tipo:n.tipo,modeloComponenteId:n.modeloComponenteId,etiqueta:n.etiqueta,numeroSerie:n.numeroSerie||"",numEjes:n.numEjes?String(n.numEjes):""}),m(!0)},U=async()=>{r?await g.mutateAsync({id:r.id,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null}):await C.mutateAsync({tipo:t.tipo,modeloComponenteId:t.modeloComponenteId,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null,orden:v.length}),m(!1),j()},z=async(n,l)=>{window.confirm(`Eliminar componente "${l}"?`)&&await F.mutateAsync(n)},B=[{key:"etiqueta",header:"Etiqueta"},{key:"tipo",header:"Tipo",render:n=>e.jsx(se,{variant:"secondary",children:de[n.tipo]??n.tipo})},{key:"modelo",header:"Modelo",render:n=>{var l;return((l=n.modeloComponente)==null?void 0:l.nombre)??"-"}},{key:"numeroSerie",header:"N/S",render:n=>n.numeroSerie||"-"},{key:"numEjes",header:"Ejes",render:n=>n.numEjes??"-"},...h?[{key:"acciones",header:"",render:n=>e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-blue-500",onClick:l=>{l.stopPropagation(),M(n)},children:e.jsx(ae,{className:"h-3.5 w-3.5"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-red-500",onClick:l=>{l.stopPropagation(),z(n.id,n.etiqueta)},children:e.jsx(oe,{className:"h-3.5 w-3.5"})})]})}]:[]],L=(r||t.tipo&&t.modeloComponenteId)&&t.etiqueta.trim();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(G,{title:s.nombre,description:[(q=s.fabricante)==null?void 0:q.nombre,(w=s.maquina)==null?void 0:w.nombre].filter(Boolean).join(" â€” ")})]}),s.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.descripcion}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"})," Componentes (",v.length,")"]}),h&&e.jsxs(d,{size:"sm",onClick:$,children:[e.jsx(W,{className:"h-4 w-4"})," Componente"]})]}),e.jsx(Z,{columns:B,data:v,emptyMessage:"Sin componentes. Anade controladores, unidades mecanicas, etc.",rowKey:n=>n.id})]}),e.jsx(X,{open:T,onOpenChange:n=>{m(n),n||j()},children:e.jsxs(Y,{className:"max-w-lg",children:[e.jsx(ee,{children:e.jsx(ne,{children:r?"Editar componente":"Nuevo componente"})}),e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Tipo de componente"}),e.jsxs(P,{value:t.tipo,onValueChange:n=>c({...t,tipo:n,modeloComponenteId:0}),children:[e.jsx(k,{children:e.jsx(A,{placeholder:"Seleccionar tipo..."})}),e.jsxs(D,{children:[e.jsx(x,{value:"controller",children:"Controlador"}),e.jsx(x,{value:"mechanical_unit",children:"Unidad mecanica"}),e.jsx(x,{value:"drive_unit",children:"Unidad de accionamiento"}),e.jsx(x,{value:"external_axis",children:"Eje externo"})]})]})]}),!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Modelo"}),t.tipo?e.jsxs(P,{value:String(t.modeloComponenteId||""),onValueChange:n=>c({...t,modeloComponenteId:Number(n)}),children:[e.jsx(k,{children:e.jsx(A,{placeholder:"Seleccionar modelo..."})}),e.jsx(D,{children:(Array.isArray(u)?u:[]).map(n=>e.jsx(x,{value:String(n.id),children:n.nombre},n.id))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecciona un tipo primero."}),t.tipo&&(u==null?void 0:u.length)===0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No hay modelos de este tipo para el fabricante ",(I=s.fabricante)==null?void 0:I.nombre,". Crea uno en Catalogos."]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Etiqueta"}),e.jsx(S,{value:t.etiqueta,onChange:n=>c({...t,etiqueta:n.target.value}),placeholder:"Ej: IRC5 Principal, MU Robot 1..."})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Numero de serie (opcional)"}),e.jsx(S,{value:t.numeroSerie,onChange:n=>c({...t,numeroSerie:n.target.value}),placeholder:"S/N..."})]}),t.tipo==="mechanical_unit"&&e.jsxs("div",{children:[e.jsx(p,{children:"Numero de ejes"}),e.jsx(S,{type:"number",value:t.numEjes,onChange:n=>c({...t,numEjes:n.target.value}),placeholder:"6",min:1})]})]}),e.jsxs(te,{children:[e.jsx(d,{variant:"outline",onClick:()=>{m(!1),j()},children:"Cancelar"}),e.jsx(d,{onClick:U,disabled:!L||C.isPending||g.isPending,children:C.isPending||g.isPending?r?"Guardando...":"Creando...":r?"Guardar":"Crear"})]})]})})]})}export{pe as default};
