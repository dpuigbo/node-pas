import{N as w,O as I,U as k,i as B,u as F,m as L,V as O,r as N,W as V,j as e,B as d,A as z,p as $,Y as H,P as K,Z as Q,D as R,e as G,f as J,g as W,h as m,y as S,z as b,E,G as q,H as p,I as j,J as Y,a as Z,T as X}from"./index-BbT_qP1u.js";import{C as ee}from"./circle-alert-BV4KW8Yv.js";function ne(t){const o=w();return I({mutationFn:i=>k.post(`/v1/sistemas/${t}/componentes`,i),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",t]})})}function ae(t){const o=w();return I({mutationFn:i=>k.delete(`/v1/sistemas/${t}/componentes/${i}`),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",t]})})}const se={controller:"Controlador",mechanical_unit:"Unidad mecanica",drive_unit:"Unidad de accionamiento"};function ie(){var g,v,f,y;const{id:t}=B(),o=Number(t),i=F(),{isAdmin:C}=L(),{data:s,isLoading:D}=O(o||void 0),h=ne(o),P=ae(o),[A,u]=N.useState(!1),[a,r]=N.useState({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),{data:l}=V(s!=null&&s.fabricanteId?{fabricanteId:s.fabricanteId,tipo:a.tipo||void 0}:void 0);if(D)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(ee,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Sistema no encontrado"}),e.jsx(d,{variant:"outline",onClick:()=>i(-1),children:"Volver"})]});const x=s.componentes??[],T=async()=>{await h.mutateAsync({tipo:a.tipo,modeloComponenteId:a.modeloComponenteId,etiqueta:a.etiqueta,numeroSerie:a.numeroSerie||null,numEjes:a.numEjes?Number(a.numEjes):null,orden:x.length}),u(!1),r({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""})},M=async(n,c)=>{window.confirm(`Eliminar componente "${c}"?`)&&await P.mutateAsync(n)},U=[{key:"etiqueta",header:"Etiqueta"},{key:"tipo",header:"Tipo",render:n=>e.jsx(Z,{variant:"secondary",children:se[n.tipo]??n.tipo})},{key:"modelo",header:"Modelo",render:n=>{var c;return((c=n.modeloComponente)==null?void 0:c.nombre)??"-"}},{key:"numeroSerie",header:"N/S",render:n=>n.numeroSerie||"-"},{key:"numEjes",header:"Ejes",render:n=>n.numEjes??"-"},...C?[{key:"acciones",header:"",render:n=>e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-red-500",onClick:c=>{c.stopPropagation(),M(n.id,n.etiqueta)},children:e.jsx(X,{className:"h-3.5 w-3.5"})})}]:[]],_=a.tipo&&a.modeloComponenteId&&a.etiqueta.trim();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx($,{title:s.nombre,description:[(g=s.fabricante)==null?void 0:g.nombre,(v=s.planta)==null?void 0:v.nombre,(f=s.maquina)==null?void 0:f.nombre].filter(Boolean).join(" â€” ")})]}),s.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.descripcion}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"})," Componentes (",x.length,")"]}),C&&e.jsxs(d,{size:"sm",onClick:()=>u(!0),children:[e.jsx(K,{className:"h-4 w-4"})," Componente"]})]}),e.jsx(Q,{columns:U,data:x,emptyMessage:"Sin componentes. Anade controladores, unidades mecanicas, etc.",rowKey:n=>n.id})]}),e.jsx(R,{open:A,onOpenChange:u,children:e.jsxs(G,{className:"max-w-lg",children:[e.jsx(J,{children:e.jsx(W,{children:"Nuevo componente"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Tipo de componente"}),e.jsxs(S,{value:a.tipo,onValueChange:n=>r({...a,tipo:n,modeloComponenteId:0}),children:[e.jsx(b,{children:e.jsx(E,{placeholder:"Seleccionar tipo..."})}),e.jsxs(q,{children:[e.jsx(p,{value:"controller",children:"Controlador"}),e.jsx(p,{value:"mechanical_unit",children:"Unidad mecanica"}),e.jsx(p,{value:"drive_unit",children:"Unidad de accionamiento"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Modelo"}),a.tipo?e.jsxs(S,{value:String(a.modeloComponenteId||""),onValueChange:n=>r({...a,modeloComponenteId:Number(n)}),children:[e.jsx(b,{children:e.jsx(E,{placeholder:"Seleccionar modelo..."})}),e.jsx(q,{children:l==null?void 0:l.map(n=>e.jsx(p,{value:String(n.id),children:n.nombre},n.id))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecciona un tipo primero."}),a.tipo&&(l==null?void 0:l.length)===0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No hay modelos de este tipo para el fabricante ",(y=s.fabricante)==null?void 0:y.nombre,". Crea uno en Catalogos."]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Etiqueta"}),e.jsx(j,{value:a.etiqueta,onChange:n=>r({...a,etiqueta:n.target.value}),placeholder:"Ej: IRC5 Principal, MU Robot 1..."})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Numero de serie (opcional)"}),e.jsx(j,{value:a.numeroSerie,onChange:n=>r({...a,numeroSerie:n.target.value}),placeholder:"S/N..."})]}),a.tipo==="mechanical_unit"&&e.jsxs("div",{children:[e.jsx(m,{children:"Numero de ejes"}),e.jsx(j,{type:"number",value:a.numEjes,onChange:n=>r({...a,numEjes:n.target.value}),placeholder:"6",min:1})]})]}),e.jsxs(Y,{children:[e.jsx(d,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(d,{onClick:T,disabled:!_||h.isPending,children:h.isPending?"Creando...":"Crear"})]})]})})]})}export{ie as default};
