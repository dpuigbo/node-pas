import{f as V,M as b,N as E,O as q,c as G,u as H,g as R,a6 as W,r as N,p as J,a7 as X,j as e,B as d,A as Y,P as Z,a8 as ee,x as ne,D as te,y as se,z as ae,E as oe,G as ie,H as p,a1 as M,a2 as _,a3 as D,a4 as T,a5 as x,W as S,I as re,a as le,t as ce,$ as de}from"./index-C75WWkRm.js";import{C as me}from"./circle-alert-CMi1ZxCY.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],pe=V("TriangleAlert",ue);function xe(o){const a=b();return E({mutationFn:i=>q.post(`/v1/sistemas/${o}/componentes`,i),onSuccess:()=>a.invalidateQueries({queryKey:["sistemas",o]})})}function he(o){const a=b();return E({mutationFn:({id:i,...h})=>q.put(`/v1/sistemas/${o}/componentes/${i}`,h),onSuccess:()=>a.invalidateQueries({queryKey:["sistemas",o]})})}function je(o){const a=b();return E({mutationFn:i=>q.delete(`/v1/sistemas/${o}/componentes/${i}`),onSuccess:()=>a.invalidateQueries({queryKey:["sistemas",o]})})}const ge={controller:"Controlador",mechanical_unit:"Unidad mecanica",drive_unit:"Unidad de accionamiento",external_axis:"Eje externo"};function fe(){var A,I,P;const{id:o}=G(),a=Number(o),i=H(),{isAdmin:h}=R(),{data:s,isLoading:F}=W(a||void 0),C=xe(a),v=he(a),$=je(a),[z,m]=N.useState(!1),[r,w]=N.useState(null),[t,c]=N.useState({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),{data:j}=J(s!=null&&s.fabricanteId&&t.tipo?{fabricanteId:s.fabricanteId,tipo:t.tipo}:void 0),{data:u}=X(a||void 0,t.tipo||void 0),k=t.tipo?t.tipo==="controller"?Array.isArray(j)?j:[]:u?u.modelos:Array.isArray(j)?j:[]:[],f=t.tipo&&t.tipo!=="controller"?u==null?void 0:u.warning:null;if(F)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Sistema no encontrado"}),e.jsx(d,{variant:"outline",onClick:()=>i(-1),children:"Volver"})]});const y=s.componentes??[],g=()=>{c({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),w(null)},L=()=>{g(),m(!0)},U=n=>{w(n),c({tipo:n.tipo,modeloComponenteId:n.modeloComponenteId,etiqueta:n.etiqueta,numeroSerie:n.numeroSerie||"",numEjes:n.numEjes?String(n.numEjes):""}),m(!0)},B=async()=>{r?await v.mutateAsync({id:r.id,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null}):await C.mutateAsync({tipo:t.tipo,modeloComponenteId:t.modeloComponenteId,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null,orden:y.length}),m(!1),g()},O=async(n,l)=>{window.confirm(`Eliminar componente "${l}"?`)&&await $.mutateAsync(n)},K=[{key:"etiqueta",header:"Etiqueta"},{key:"tipo",header:"Tipo",render:n=>e.jsx(le,{variant:"secondary",children:ge[n.tipo]??n.tipo})},{key:"modelo",header:"Modelo",render:n=>{var l;return((l=n.modeloComponente)==null?void 0:l.nombre)??"-"}},{key:"numeroSerie",header:"N/S",render:n=>n.numeroSerie||"-"},{key:"numEjes",header:"Ejes",render:n=>n.numEjes??"-"},...h?[{key:"acciones",header:"",render:n=>e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-blue-500",onClick:l=>{l.stopPropagation(),U(n)},children:e.jsx(ce,{className:"h-3.5 w-3.5"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-red-500",onClick:l=>{l.stopPropagation(),O(n.id,n.etiqueta)},children:e.jsx(de,{className:"h-3.5 w-3.5"})})]})}]:[]],Q=(r||t.tipo&&t.modeloComponenteId)&&t.etiqueta.trim();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(Z,{title:s.nombre,description:[(A=s.fabricante)==null?void 0:A.nombre,(I=s.maquina)==null?void 0:I.nombre].filter(Boolean).join(" â€” ")})]}),s.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.descripcion}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"})," Componentes (",y.length,")"]}),h&&e.jsxs(d,{size:"sm",onClick:L,children:[e.jsx(ne,{className:"h-4 w-4"})," Componente"]})]}),e.jsx(te,{columns:K,data:y,emptyMessage:"Sin componentes. Anade controladores, unidades mecanicas, etc.",rowKey:n=>n.id})]}),e.jsx(se,{open:z,onOpenChange:n=>{m(n),n||g()},children:e.jsxs(ae,{className:"max-w-lg",children:[e.jsx(oe,{children:e.jsx(ie,{children:r?"Editar componente":"Nuevo componente"})}),e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Tipo de componente"}),e.jsxs(M,{value:t.tipo,onValueChange:n=>c({...t,tipo:n,modeloComponenteId:0}),children:[e.jsx(_,{children:e.jsx(D,{placeholder:"Seleccionar tipo..."})}),e.jsxs(T,{children:[e.jsx(x,{value:"controller",children:"Controlador"}),e.jsx(x,{value:"mechanical_unit",children:"Unidad mecanica"}),e.jsx(x,{value:"drive_unit",children:"Unidad de accionamiento"}),e.jsx(x,{value:"external_axis",children:"Eje externo"})]})]})]}),!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Modelo"}),t.tipo?e.jsxs(M,{value:String(t.modeloComponenteId||""),onValueChange:n=>c({...t,modeloComponenteId:Number(n)}),children:[e.jsx(_,{children:e.jsx(D,{placeholder:"Seleccionar modelo..."})}),e.jsx(T,{children:k.map(n=>e.jsx(x,{value:String(n.id),children:n.nombre},n.id))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecciona un tipo primero."}),f&&e.jsxs("p",{className:"text-xs text-orange-500 mt-1 flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 shrink-0"}),f]}),t.tipo&&k.length===0&&!f&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No hay modelos de este tipo para el fabricante ",(P=s.fabricante)==null?void 0:P.nombre,". Crea uno en Catalogos."]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Etiqueta"}),e.jsx(S,{value:t.etiqueta,onChange:n=>c({...t,etiqueta:n.target.value}),placeholder:"Ej: IRC5 Principal, MU Robot 1..."})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Numero de serie (opcional)"}),e.jsx(S,{value:t.numeroSerie,onChange:n=>c({...t,numeroSerie:n.target.value}),placeholder:"S/N..."})]}),t.tipo==="mechanical_unit"&&e.jsxs("div",{children:[e.jsx(p,{children:"Numero de ejes"}),e.jsx(S,{type:"number",value:t.numEjes,onChange:n=>c({...t,numEjes:n.target.value}),placeholder:"6",min:1})]})]}),e.jsxs(re,{children:[e.jsx(d,{variant:"outline",onClick:()=>{m(!1),g()},children:"Cancelar"}),e.jsx(d,{onClick:B,disabled:!Q||C.isPending||v.isPending,children:C.isPending||v.isPending?r?"Guardando...":"Creando...":r?"Guardar":"Crear"})]})]})})]})}export{fe as default};
