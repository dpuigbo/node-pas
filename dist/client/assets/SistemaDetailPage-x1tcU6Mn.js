import{H as y,I as N,J as b,c as K,u as O,g as V,a2 as H,r as f,a3 as R,j as e,B as d,A as G,P as J,a4 as W,s as Z,D as X,t as Y,v as ee,w as ne,x as te,y as p,Z as k,_ as A,$ as D,a0 as _,a1 as x,Q as S,z as se,a as ae,p as oe,W as ie}from"./index-DNmmFyKn.js";import{C as re}from"./circle-alert-BQafVyc2.js";function le(a){const o=y();return N({mutationFn:i=>b.post(`/v1/sistemas/${a}/componentes`,i),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}function ce(a){const o=y();return N({mutationFn:({id:i,...h})=>b.put(`/v1/sistemas/${a}/componentes/${i}`,h),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}function de(a){const o=y();return N({mutationFn:i=>b.delete(`/v1/sistemas/${a}/componentes/${i}`),onSuccess:()=>o.invalidateQueries({queryKey:["sistemas",a]})})}const me={controller:"Controlador",mechanical_unit:"Unidad mecanica",drive_unit:"Unidad de accionamiento",external_axis:"Eje externo"};function xe(){var q,w,I,P;const{id:a}=K(),o=Number(a),i=O(),{isAdmin:h}=V(),{data:s,isLoading:F}=H(o||void 0),C=le(o),g=ce(o),T=de(o),[$,m]=f.useState(!1),[r,E]=f.useState(null),[t,c]=f.useState({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),{data:u}=R(s!=null&&s.fabricanteId?{fabricanteId:s.fabricanteId,tipo:t.tipo||void 0}:void 0);if(F)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Sistema no encontrado"}),e.jsx(d,{variant:"outline",onClick:()=>i(-1),children:"Volver"})]});const v=s.componentes??[],j=()=>{c({tipo:"",modeloComponenteId:0,etiqueta:"",numeroSerie:"",numEjes:""}),E(null)},M=()=>{j(),m(!0)},U=n=>{E(n),c({tipo:n.tipo,modeloComponenteId:n.modeloComponenteId,etiqueta:n.etiqueta,numeroSerie:n.numeroSerie||"",numEjes:n.numEjes?String(n.numEjes):""}),m(!0)},z=async()=>{r?await g.mutateAsync({id:r.id,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null}):await C.mutateAsync({tipo:t.tipo,modeloComponenteId:t.modeloComponenteId,etiqueta:t.etiqueta,numeroSerie:t.numeroSerie||null,numEjes:t.numEjes?Number(t.numEjes):null,orden:v.length}),m(!1),j()},B=async(n,l)=>{window.confirm(`Eliminar componente "${l}"?`)&&await T.mutateAsync(n)},L=[{key:"etiqueta",header:"Etiqueta"},{key:"tipo",header:"Tipo",render:n=>e.jsx(ae,{variant:"secondary",children:me[n.tipo]??n.tipo})},{key:"modelo",header:"Modelo",render:n=>{var l;return((l=n.modeloComponente)==null?void 0:l.nombre)??"-"}},{key:"numeroSerie",header:"N/S",render:n=>n.numeroSerie||"-"},{key:"numEjes",header:"Ejes",render:n=>n.numEjes??"-"},...h?[{key:"acciones",header:"",render:n=>e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-blue-500",onClick:l=>{l.stopPropagation(),U(n)},children:e.jsx(oe,{className:"h-3.5 w-3.5"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-red-500",onClick:l=>{l.stopPropagation(),B(n.id,n.etiqueta)},children:e.jsx(ie,{className:"h-3.5 w-3.5"})})]})}]:[]],Q=(r||t.tipo&&t.modeloComponenteId)&&t.etiqueta.trim();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(J,{title:s.nombre,description:[(q=s.fabricante)==null?void 0:q.nombre,(w=s.planta)==null?void 0:w.nombre,(I=s.maquina)==null?void 0:I.nombre].filter(Boolean).join(" â€” ")})]}),s.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.descripcion}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"})," Componentes (",v.length,")"]}),h&&e.jsxs(d,{size:"sm",onClick:M,children:[e.jsx(Z,{className:"h-4 w-4"})," Componente"]})]}),e.jsx(X,{columns:L,data:v,emptyMessage:"Sin componentes. Anade controladores, unidades mecanicas, etc.",rowKey:n=>n.id})]}),e.jsx(Y,{open:$,onOpenChange:n=>{m(n),n||j()},children:e.jsxs(ee,{className:"max-w-lg",children:[e.jsx(ne,{children:e.jsx(te,{children:r?"Editar componente":"Nuevo componente"})}),e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Tipo de componente"}),e.jsxs(k,{value:t.tipo,onValueChange:n=>c({...t,tipo:n,modeloComponenteId:0}),children:[e.jsx(A,{children:e.jsx(D,{placeholder:"Seleccionar tipo..."})}),e.jsxs(_,{children:[e.jsx(x,{value:"controller",children:"Controlador"}),e.jsx(x,{value:"mechanical_unit",children:"Unidad mecanica"}),e.jsx(x,{value:"drive_unit",children:"Unidad de accionamiento"}),e.jsx(x,{value:"external_axis",children:"Eje externo"})]})]})]}),!r&&e.jsxs("div",{children:[e.jsx(p,{children:"Modelo"}),t.tipo?e.jsxs(k,{value:String(t.modeloComponenteId||""),onValueChange:n=>c({...t,modeloComponenteId:Number(n)}),children:[e.jsx(A,{children:e.jsx(D,{placeholder:"Seleccionar modelo..."})}),e.jsx(_,{children:(Array.isArray(u)?u:[]).map(n=>e.jsx(x,{value:String(n.id),children:n.nombre},n.id))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecciona un tipo primero."}),t.tipo&&(u==null?void 0:u.length)===0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No hay modelos de este tipo para el fabricante ",(P=s.fabricante)==null?void 0:P.nombre,". Crea uno en Catalogos."]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Etiqueta"}),e.jsx(S,{value:t.etiqueta,onChange:n=>c({...t,etiqueta:n.target.value}),placeholder:"Ej: IRC5 Principal, MU Robot 1..."})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Numero de serie (opcional)"}),e.jsx(S,{value:t.numeroSerie,onChange:n=>c({...t,numeroSerie:n.target.value}),placeholder:"S/N..."})]}),t.tipo==="mechanical_unit"&&e.jsxs("div",{children:[e.jsx(p,{children:"Numero de ejes"}),e.jsx(S,{type:"number",value:t.numEjes,onChange:n=>c({...t,numEjes:n.target.value}),placeholder:"6",min:1})]})]}),e.jsxs(se,{children:[e.jsx(d,{variant:"outline",onClick:()=>{m(!1),j()},children:"Cancelar"}),e.jsx(d,{onClick:z,disabled:!Q||C.isPending||g.isPending,children:C.isPending||g.isPending?r?"Guardando...":"Creando...":r?"Guardar":"Crear"})]})]})})]})}export{xe as default};
