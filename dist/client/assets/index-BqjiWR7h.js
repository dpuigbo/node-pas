import{f as _,a4 as A,r as $,j as e,a6 as q,s as d,_ as u,T as G,a2 as ee,$ as M,B as S,m as F,X as se}from"./index-Dzjl4Jx6.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],ae=_("AlignCenter",te);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],re=_("AlignLeft",le);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],ne=_("AlignRight",ce);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],oe=_("Calendar",ie);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]],xe=_("Eraser",de);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M21 7h-3a2 2 0 0 1-2-2V2",key:"9rb54x"}],["path",{d:"M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17Z",key:"1059l0"}],["path",{d:"M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15",key:"16874u"}],["path",{d:"M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11",key:"k2ox98"}]],ue=_("FileStack",me);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],X=_("Image",he);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],ge=_("List",pe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],be=_("Pen",fe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],ve=_("Square",je);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ye=_("Upload",Ne),O=l=>{let t;const a=new Set,s=(x,m)=>{const h=typeof x=="function"?x(t):x;if(!Object.is(h,t)){const g=t;t=m??(typeof h!="object"||h===null)?h:Object.assign({},t,h),a.forEach(p=>p(t,g))}},r=()=>t,n={setState:s,getState:r,getInitialState:()=>o,subscribe:x=>(a.add(x),()=>a.delete(x))},o=t=l(s,r,n);return n},we=(l=>l?O(l):O),ke=l=>l;function Ce(l,t=ke){const a=A.useSyncExternalStore(l.subscribe,A.useCallback(()=>t(l.getState()),[l,t]),A.useCallback(()=>t(l.getInitialState()),[l,t]));return A.useDebugValue(a),a}const K=l=>{const t=we(l),a=s=>Ce(t,s);return Object.assign(a,t),a},_e=(l=>l?K(l):K),B={orientation:"portrait",margins:{top:20,right:15,bottom:20,left:15},fontSize:10},U={full:"Completo",half:"Mitad",third:"Tercio",two_thirds:"Dos tercios"},Hs={full:"w-full",half:"w-1/2",third:"w-1/3",two_thirds:"w-2/3"},Us={left:"text-left",center:"text-center",right:"text-right"},Pe={full:1,half:.5,third:.333,two_thirds:.667},J=[{id:"portada",label:"Portada",color:"#2563eb"},{id:"intermedia",label:"Pagina Intermedia (Cabecera + Pie)",color:"#059669"},{id:"contraportada",label:"Contraportada",color:"#7c3aed"}],Z={general:"General",level1:"Nivel 1",level2:"Nivel 2",level3:"Nivel 3"},$e={general:"bg-gray-100 text-gray-700",level1:"bg-green-100 text-green-700",level2:"bg-amber-100 text-amber-700",level3:"bg-red-100 text-red-700"},Q=new Map;function y(l){Q.set(l.definition.type,l)}function zs(l){return Q.get(l)}const j={header:{type:"header",label:"Cabecera",icon:"FileText",category:"structure",hasData:!1,defaultConfig:{title:"Informe de Mantenimiento",subtitle:"",showLogo:!0,showDate:!0,showReference:!0,logoPosition:"left",logoUrl:""}},section_title:{type:"section_title",label:"Titulo de seccion",icon:"Heading",category:"structure",hasData:!1,defaultConfig:{title:"Nueva seccion",description:"",level:1,color:"#2563eb"}},divider:{type:"divider",label:"Separador",icon:"Minus",category:"structure",hasData:!1,defaultConfig:{style:"solid",spacing:"medium",color:"#e5e7eb"}},text_field:{type:"text_field",label:"Campo de texto",icon:"Type",category:"data",hasData:!0,defaultConfig:{key:"",label:"Campo de texto",required:!1,width:"full",helpText:"",placeholder:""}},number_field:{type:"number_field",label:"Campo numerico",icon:"Hash",category:"data",hasData:!0,defaultConfig:{key:"",label:"Campo numerico",required:!1,width:"full",helpText:"",unit:"",min:null,max:null}},date_field:{type:"date_field",label:"Campo de fecha",icon:"Calendar",category:"data",hasData:!0,defaultConfig:{key:"",label:"Fecha",required:!1,width:"full",helpText:""}},text_area:{type:"text_area",label:"Area de texto",icon:"AlignLeft",category:"data",hasData:!0,defaultConfig:{key:"",label:"Area de texto",required:!1,width:"full",helpText:"",rows:3,placeholder:""}},select_field:{type:"select_field",label:"Selector",icon:"ChevronDown",category:"data",hasData:!0,defaultConfig:{key:"",label:"Selector",required:!1,width:"full",helpText:"",options:[]}},tristate:{type:"tristate",label:"Inspeccion OK/NOK/NA",icon:"CheckCircle",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Punto de inspeccion",withObservation:!0,required:!1,maintenanceLevel:"general"}},checklist:{type:"checklist",label:"Lista de verificacion",icon:"ListChecks",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Lista de verificacion",items:[]}},table:{type:"table",label:"Tabla de datos",icon:"Table",category:"inspection",hasData:!0,defaultConfig:{key:"",label:"Tabla",columns:[],fixedRows:[],allowAddRows:!0,minRows:0,maxRows:50}},image:{type:"image",label:"Imagen",icon:"Image",category:"media",hasData:!0,defaultConfig:{key:"",label:"Imagen",allowMultiple:!1,maxFiles:1,maxSizeMB:5,width:"full"}},signature:{type:"signature",label:"Firma",icon:"Pen",category:"media",hasData:!0,defaultConfig:{key:"",label:"Firma",role:"Tecnico",required:!1,width:"half"}},section_separator:{type:"section_separator",label:"Separador de seccion",icon:"FileStack",category:"structure",hasData:!1,defaultConfig:{section:"portada"}},table_of_contents:{type:"table_of_contents",label:"Tabla de contenidos",icon:"List",category:"structure",hasData:!1,defaultConfig:{title:"Tabla de contenidos"}},cover_header:{type:"cover_header",label:"Portada (banner)",icon:"BookOpen",category:"document",hasData:!1,defaultConfig:{title:"Reporte de mantenimiento",subtitle:"",companyName:"PAS Robotics",logoUrl:"",logoPosition:"right",backgroundColor:"#000000"}},page_header:{type:"page_header",label:"Cabecera de pagina",icon:"PanelTop",category:"document",hasData:!1,defaultConfig:{title:"Reporte de mantenimiento",subtitle:"",logoUrl:"",backgroundColor:"#1f2937"}},page_footer:{type:"page_footer",label:"Pie de pagina",icon:"PanelBottom",category:"document",hasData:!1,defaultConfig:{companyName:"PAS Robotics",showPageNumbers:!0,showTriangle:!0,backgroundColor:"#1f2937"}},back_cover:{type:"back_cover",label:"Contraportada",icon:"Square",category:"document",hasData:!1,defaultConfig:{logoUrl:"",backgroundColor:"#111827"}}},Os=[{id:"structure",label:"Estructura",types:["header","section_title","divider","table_of_contents"]},{id:"data",label:"Campos de datos",types:["text_field","number_field","date_field","text_area","select_field"]},{id:"inspection",label:"Inspeccion",types:["tristate","checklist","table"]},{id:"media",label:"Media y firma",types:["image","signature"]},{id:"document",label:"Documento",types:["cover_header","page_header","page_footer","back_cover"]}];function Se(l,t,a){const s={...l},r=t.split(".");let c=s;for(let n=0;n<r.length-1;n++){const o=r[n],x=r[n+1],m=x!=null&&/^\d+$/.test(x);Array.isArray(c[o])?c[o]=[...c[o]]:typeof c[o]=="object"&&c[o]!==null?c[o]={...c[o]}:c[o]=m?[]:{},c=c[o]}const i=r[r.length-1];return i!=null&&(c[i]=a),s}function W(l,t){const a=l.replace(/_/g,"_"),s=t.filter(c=>c.type===l).map(c=>{const n=(c.config.key||"").match(new RegExp(`^${a}_(\\d+)$`));return(n==null?void 0:n[1])!=null?parseInt(n[1],10):0}),r=s.length>0?Math.max(...s):0;return`${a}_${r+1}`}function V(){return crypto.randomUUID()}const Y=["portada","intermedia","contraportada"];function Ie(l){const a=l.filter(c=>c.type==="section_separator").map(c=>c.config.section);if(Y.every(c=>a.includes(c)))return l;const s=l.filter(c=>c.type!=="section_separator"),r=[];for(const c of Y)r.push({id:`section-${c}`,type:"section_separator",config:{section:c}});return s.length>0&&r.splice(1,0,...s),r}const H=_e((l,t)=>({blocks:[],pageConfig:{...B},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,isDocumentTemplate:!1,blockHeights:new Map,loadSchema:(a,s,r,c=!1)=>{let i=a.blocks||[];c&&(i=Ie(i)),l({blocks:i,pageConfig:a.pageConfig||{...B},selectedBlockId:null,isDirty:!1,versionId:r,modeloId:s,isDocumentTemplate:c,blockHeights:new Map})},addBlock:(a,s)=>{const r=j[a];if(!r)return;const{blocks:c,selectedBlockId:i,isDocumentTemplate:n}=t(),o={...r.defaultConfig};r.hasData&&(o.key=W(a,c));const x={id:V(),type:a,config:o},m=[...c];if(s!==void 0&&s>=0&&s<=c.length)m.splice(s,0,x);else if(n)if(i){const h=c.findIndex(g=>g.id===i);if(h!==-1)if(c[h].type==="section_separator"){let p=h+1;for(;p<c.length&&c[p].type!=="section_separator";)p++;m.splice(p,0,x)}else m.splice(h+1,0,x);else{const g=c.findIndex((p,w)=>w>0&&p.type==="section_separator");m.splice(g!==-1?g:c.length,0,x)}}else{const h=c.findIndex((g,p)=>p>0&&g.type==="section_separator");m.splice(h!==-1?h:c.length,0,x)}else m.push(x);l({blocks:m,isDirty:!0,selectedBlockId:x.id})},removeBlock:a=>{const{blocks:s,selectedBlockId:r}=t(),c=s.find(n=>n.id===a);if((c==null?void 0:c.type)==="section_separator")return;const i=new Map(t().blockHeights);i.delete(a),l({blocks:s.filter(n=>n.id!==a),isDirty:!0,selectedBlockId:r===a?null:r,blockHeights:i})},duplicateBlock:a=>{const{blocks:s}=t(),r=s.findIndex(m=>m.id===a);if(r===-1)return;const c=s[r];if(c.type==="section_separator")return;const i=j[c.type],n=JSON.parse(JSON.stringify(c.config));i!=null&&i.hasData&&n.key&&(n.key=W(c.type,s));const o={id:V(),type:c.type,config:n},x=[...s];x.splice(r+1,0,o),l({blocks:x,isDirty:!0,selectedBlockId:o.id})},moveBlock:(a,s)=>{const{blocks:r}=t(),c=r.findIndex(h=>h.id===a);if(c===-1||r[c].type==="section_separator")return;const n=s==="up"?c-1:c+1;if(n<0||n>=r.length||r[n].type==="section_separator")return;const o=[...r],x=o[c],m=o[n];o[c]=m,o[n]=x,l({blocks:o,isDirty:!0})},reorderBlocks:a=>{const{blocks:s}=t(),r=new Map(s.map(n=>[n.id,n])),c=a.map(n=>r.get(n)).filter(Boolean),i=s.filter(n=>!a.includes(n.id));l({blocks:[...c,...i],isDirty:!0})},updateBlockConfig:(a,s,r)=>{const{blocks:c}=t();l({blocks:c.map(i=>i.id===a?{...i,config:Se(i.config,s,r)}:i),isDirty:!0})},selectBlock:a=>{l({selectedBlockId:a})},updatePageConfig:a=>{const{pageConfig:s}=t();l({pageConfig:{...s,...a},isDirty:!0})},setBlockHeight:(a,s)=>{const{blockHeights:r}=t();if(r.get(a)===s)return;const c=new Map(r);c.set(a,s),l({blockHeights:c})},getSchema:()=>{const{blocks:a,pageConfig:s}=t();return{blocks:a,pageConfig:s}},markClean:()=>{l({isDirty:!1})},reset:()=>{l({blocks:[],pageConfig:{...B},selectedBlockId:null,isDirty:!1,versionId:null,modeloId:null,isDocumentTemplate:!1,blockHeights:new Map})}})),Ee=794,Me=1123,Fe=3.78,Te=new Set(["header","section_title","divider","tristate","checklist","table","section_separator","table_of_contents","cover_header","page_header","page_footer","back_cover"]);function Re(l){if(Te.has(l.type))return 1;const t=l.config.width||"full";return Pe[t]??1}function De({blocks:l,pageConfig:t,blockHeights:a}){return $.useMemo(()=>{if(l.length===0)return{pages:[{pageIndex:0,blockIds:[]}],totalPages:1};const c=(t.orientation==="portrait"?Me:Ee)-(t.margins.top+t.margins.bottom)*Fe,i=[];let n={pageIndex:0,blockIds:[]},o=0,x=0,m=0,h=[];const g=()=>{h.length!==0&&(o+m>c&&n.blockIds.length>0&&(i.push(n),n={pageIndex:i.length,blockIds:[]},o=0),n.blockIds.push(...h),o+=m,x=0,m=0,h=[])};for(const p of l){if(p.type==="section_separator"){g(),n.blockIds.length>0&&(i.push(n),n={pageIndex:i.length,blockIds:[]},o=0),n.blockIds.push(p.id);const k=a.get(p.id)||40;o+=k;continue}const w=Re(p),P=a.get(p.id)||30;x+w>1.01&&h.length>0&&g(),h.push(p.id),x+=w,m=Math.max(m,P),w>=1&&g()}return g(),(n.blockIds.length>0||i.length===0)&&i.push(n),{pages:i,totalPages:i.length}},[l,t,a])}function Ae({block:l}){const t=l.config,a=t.title||"Informe de Mantenimiento",s=t.subtitle||"",r=t.showLogo!==!1,c=t.showDate!==!1,i=t.showReference!==!1,n=t.logoPosition||"left";return e.jsx("div",{className:"border-b pb-3 mb-2",children:e.jsxs("div",{className:`flex items-start gap-4 ${n==="right"?"flex-row-reverse":n==="center"?"flex-col items-center":""}`,children:[r&&e.jsx("div",{className:"flex h-14 w-14 shrink-0 items-center justify-center rounded-lg bg-gray-100 border border-dashed border-gray-300",children:e.jsx(q,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{className:`flex-1 ${n==="center"?"text-center":""}`,children:[e.jsx("h1",{className:"text-lg font-bold leading-tight",children:a}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:s}),e.jsxs("div",{className:"flex gap-4 mt-2 text-[10px] text-gray-400",children:[c&&e.jsx("span",{children:"Fecha: ____/____/________"}),i&&e.jsx("span",{children:"Ref: __________"})]})]})]})})}const qe=[{value:"left",icon:re,label:"Izquierda"},{value:"center",icon:ae,label:"Centro"},{value:"right",icon:ne,label:"Derecha"}];function L({value:l,onChange:t}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Alineacion"}),e.jsx("div",{className:"flex gap-1",children:qe.map(a=>{const s=a.icon;return e.jsx("button",{className:`flex-1 flex items-center justify-center gap-1 rounded border px-2 py-1 text-xs ${l===a.value?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t(a.value),title:a.label,children:e.jsx(s,{className:"h-3.5 w-3.5"})},a.value)})})]})}function Le({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Titulo"}),e.jsx(u,{value:a.title||"",onChange:s=>t("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Subtitulo"}),e.jsx(u,{value:a.subtitle||"",onChange:s=>t("subtitle",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showLogo",checked:a.showLogo!==!1,onChange:s=>t("showLogo",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:"showLogo",className:"text-xs cursor-pointer",children:"Mostrar logo"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Posicion del logo"}),e.jsx("div",{className:"flex gap-1",children:["left","center","right"].map(s=>e.jsx("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(a.logoPosition||"left")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("logoPosition",s),children:s==="left"?"Izquierda":s==="center"?"Centro":"Derecha"},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"URL del logo"}),e.jsx(u,{value:a.logoUrl||"",onChange:s=>t("logoUrl",s.target.value),placeholder:"https://...",className:"h-8"})]}),e.jsx(L,{value:a.align||"left",onChange:s=>t("align",s)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showDate",checked:a.showDate!==!1,onChange:s=>t("showDate",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:"showDate",className:"text-xs cursor-pointer",children:"Mostrar fecha"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showReference",checked:a.showReference!==!1,onChange:s=>t("showReference",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:"showReference",className:"text-xs cursor-pointer",children:"Mostrar referencia"})]})]})}y({definition:j.header,EditorPreview:Ae,ConfigPanel:Le});function Be({block:l}){const t=l.config,a=t.title||"Seccion",s=t.description||"",r=t.level||1,c=t.color||"#2563eb",i={1:"text-base font-bold",2:"text-sm font-semibold",3:"text-xs font-semibold"};return e.jsxs("div",{className:"flex items-start gap-2 py-2",children:[e.jsx("div",{className:"w-1 shrink-0 rounded-full self-stretch",style:{backgroundColor:c}}),e.jsxs("div",{children:[e.jsx("div",{className:i[r]||i[1],children:a}),s&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5",children:s})]})]})}function He({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Titulo"}),e.jsx(u,{value:a.title||"",onChange:s=>t("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Descripcion"}),e.jsx(u,{value:a.description||"",onChange:s=>t("description",s.target.value),placeholder:"Opcional",className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nivel"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(s=>e.jsxs("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(a.level||1)===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("level",s),children:["Nivel ",s]},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.color||"#2563eb",onChange:s=>t("color",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.color||"#2563eb",onChange:s=>t("color",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]}),e.jsx(L,{value:a.align||"left",onChange:s=>t("align",s)})]})}y({definition:j.section_title,EditorPreview:Be,ConfigPanel:He});function Ue({block:l}){const t=l.config,a=t.style||"solid",s=t.spacing||"medium",r=t.color||"#e5e7eb",c={small:"py-1",medium:"py-3",large:"py-5"};if(a==="space")return e.jsx("div",{className:c[s]||c.medium});const i=a==="dashed"?"dashed":a==="dotted"?"dotted":"solid";return e.jsx("div",{className:c[s]||c.medium,children:e.jsx("hr",{style:{borderTopStyle:i,borderTopColor:r,borderTopWidth:"1px"},className:"border-0"})})}function ze({block:l,onChange:t}){const a=l.config,s=[{value:"solid",label:"Solido"},{value:"dashed",label:"Discontinuo"},{value:"dotted",label:"Punteado"},{value:"space",label:"Espacio"}],r=[{value:"small",label:"Pequeno"},{value:"medium",label:"Mediano"},{value:"large",label:"Grande"}];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Estilo"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:s.map(c=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(a.style||"solid")===c.value?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("style",c.value),children:c.label},c.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Espaciado"}),e.jsx("div",{className:"flex gap-1",children:r.map(c=>e.jsx("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(a.spacing||"medium")===c.value?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("spacing",c.value),children:c.label},c.value))})]}),e.jsx(L,{value:a.align||"left",onChange:c=>t("align",c)}),a.style!=="space"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.color||"#e5e7eb",onChange:c=>t("color",c.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.color||"#e5e7eb",onChange:c=>t("color",c.target.value),className:"h-8 font-mono text-xs flex-1"})]})]})]})}y({definition:j.divider,EditorPreview:Ue,ConfigPanel:ze});function Oe({block:l}){const t=l.config.title||"Tabla de contenidos",a=H(o=>o.blocks),s=H(o=>o.pageConfig),r=H(o=>o.blockHeights),{pages:c}=De({blocks:a,pageConfig:s,blockHeights:r}),i=new Map;for(const o of c)for(const x of o.blockIds)i.set(x,o.pageIndex+1);const n=a.filter(o=>o.type==="section_title").map((o,x)=>({number:x+1,title:o.config.title||"Seccion",level:o.config.level||1,pageNumber:i.get(o.id)??"—"}));return e.jsxs("div",{className:"py-4 px-2",children:[e.jsx("h3",{className:"text-base font-bold mb-4",children:t}),n.length===0?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("p",{className:"text-xs italic",children:"No hay titulos de seccion en la plantilla"})]}):e.jsx("div",{className:"space-y-2 pl-4 pr-2",children:n.map(o=>e.jsxs("div",{className:"flex items-baseline gap-2",style:{paddingLeft:o.level>1?`${(o.level-1)*16}px`:0},children:[e.jsx("span",{className:"font-semibold text-sm shrink-0 w-5 text-right",children:o.number}),e.jsx("span",{className:"font-medium text-sm truncate",children:o.title}),e.jsx("span",{className:"flex-1 border-b border-dotted border-gray-300 min-w-[20px] self-end mb-0.5"}),e.jsx("span",{className:"text-sm text-muted-foreground shrink-0 font-medium",children:o.pageNumber})]},o.number))})]})}function Ke({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Titulo"}),e.jsx(u,{value:a.title||"",onChange:s=>t("title",s.target.value),className:"h-8"})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Este bloque genera automaticamente un indice con todos los titulos de seccion de la plantilla y sus numeros de pagina."})]})}y({definition:j.table_of_contents,EditorPreview:Oe,ConfigPanel:Ke});function T({block:l,children:t}){const a=l.config,s=a.label||"Campo",r=!!a.required,c=a.helpText||"";return e.jsx("div",{className:"py-1",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700",children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),t,c&&e.jsx("div",{className:"text-[10px] text-gray-400",children:c})]})})}function We({block:l}){const t=l.config.placeholder||"";return e.jsx(T,{block:l,children:e.jsx("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center",children:t&&e.jsx("span",{className:"text-[10px] text-gray-300",children:t})})})}function R({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:s=>t("label",s.target.value),placeholder:"Etiqueta del campo",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!a.required,onChange:s=>t("required",s.target.checked),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(d,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(U).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${a.width===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("width",s),children:r},s))})]}),e.jsx(L,{value:a.align||"left",onChange:s=>t("align",s)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Texto de ayuda"}),e.jsx(u,{value:a.helpText||"",onChange:s=>t("helpText",s.target.value),placeholder:"Opcional",className:"h-8"})]})]})}function Ve({block:l,onChange:t}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{block:l,onChange:t}),e.jsxs("div",{className:"border-t pt-3 space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Placeholder"}),e.jsx(u,{value:l.config.placeholder||"",onChange:a=>t("placeholder",a.target.value),placeholder:"Texto de ejemplo...",className:"h-8"})]})]})}function Ye({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Campo",i=r.placeholder||"",n=!!r.required,o=r.helpText||"";return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(d,{children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx(u,{value:t??"",onChange:x=>a(x.target.value||null),placeholder:i,readOnly:s,disabled:s}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})}y({definition:j.text_field,EditorPreview:We,ConfigPanel:Ve,FormField:Ye});function Ge({block:l}){const t=l.config,a=t.unit||"",s=t.min,r=t.max;return e.jsxs(T,{block:l,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-7 flex-1 rounded border border-gray-200 bg-gray-50 px-2 flex items-center",children:e.jsx("span",{className:"text-[10px] text-gray-300",children:"0"})}),a&&e.jsx("span",{className:"shrink-0 rounded bg-gray-100 px-1.5 py-1 text-[10px] font-medium text-gray-500",children:a})]}),(s!==null||r!==null)&&e.jsxs("div",{className:"text-[9px] text-gray-300 mt-0.5",children:[s!==null&&`Min: ${s}`,s!==null&&r!==null&&" · ",r!==null&&`Max: ${r}`]})]})}function Xe({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{block:l,onChange:t}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Unidad"}),e.jsx(u,{value:a.unit||"",onChange:s=>t("unit",s.target.value),placeholder:"mm, V, A, bar...",className:"h-8"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Minimo"}),e.jsx(u,{type:"number",value:a.min!==null&&a.min!==void 0?String(a.min):"",onChange:s=>t("min",s.target.value?Number(s.target.value):null),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Maximo"}),e.jsx(u,{type:"number",value:a.max!==null&&a.max!==void 0?String(a.max):"",onChange:s=>t("max",s.target.value?Number(s.target.value):null),className:"h-8"})]})]})]})]})}function Je({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Campo numerico",i=r.unit||"",n=!!r.required,o=r.helpText||"",x=r.min,m=r.max;return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(d,{children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",value:t!=null?String(t):"",onChange:h=>{const g=h.target.value;a(g===""?null:Number(g))},readOnly:s,disabled:s,min:x??void 0,max:m??void 0}),i&&e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:i})]}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})}y({definition:j.number_field,EditorPreview:Ge,ConfigPanel:Xe,FormField:Je});function Ze({block:l}){return e.jsx(T,{block:l,children:e.jsxs("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-300",children:"DD/MM/AAAA"}),e.jsx(oe,{className:"h-3 w-3 text-gray-300"})]})})}function Qe({block:l,onChange:t}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{block:l,onChange:t}),e.jsx("p",{className:"text-[10px] text-muted-foreground border-t pt-2",children:"Este campo no tiene configuracion adicional."})]})}function es({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Fecha",i=!!r.required,n=r.helpText||"";return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(d,{children:[c,i&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx(u,{type:"date",value:t??"",onChange:o=>a(o.target.value||null),readOnly:s,disabled:s}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n})]})}y({definition:j.date_field,EditorPreview:Ze,ConfigPanel:Qe,FormField:es});function ss({block:l}){const t=l.config,a=t.rows||3,s=t.placeholder||"";return e.jsx(T,{block:l,children:e.jsx("div",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-1",style:{minHeight:`${a*18}px`},children:s&&e.jsx("span",{className:"text-[10px] text-gray-300",children:s})})})}function ts({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{block:l,onChange:t}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Filas visibles"}),e.jsx(u,{type:"number",min:2,max:10,value:a.rows||3,onChange:s=>t("rows",Math.max(2,Math.min(10,Number(s.target.value)||3))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Placeholder"}),e.jsx(u,{value:a.placeholder||"",onChange:s=>t("placeholder",s.target.value),placeholder:"Texto de ejemplo...",className:"h-8"})]})]})]})}function as({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Area de texto",i=r.placeholder||"",n=!!r.required,o=r.helpText||"",x=r.rows||3;return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(d,{children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx(G,{value:t??"",onChange:m=>a(m.target.value||null),placeholder:i,readOnly:s,disabled:s,rows:x}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})}y({definition:j.text_area,EditorPreview:ss,ConfigPanel:ts,FormField:as});function ls({block:l}){const t=l.config.options||[];return e.jsx(T,{block:l,children:e.jsxs("div",{className:"h-7 rounded border border-gray-200 bg-gray-50 px-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-300",children:t.length>0?`${t.length} opciones`:"Sin opciones"}),e.jsx(ee,{className:"h-3 w-3 text-gray-300"})]})})}function rs({options:l,onChange:t}){const a=()=>{const c=l.length+1;t([...l,{value:`opcion_${c}`,label:`Opcion ${c}`}])},s=c=>{t(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((x,m)=>m===c?{...x,[i]:n}:x);t(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-xs",children:"Opciones"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin opciones definidas"}),l.map((c,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{value:c.value,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"value",o)},placeholder:"valor",className:"h-7 text-xs font-mono flex-1"}),e.jsx(u,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-7 text-xs flex-1"}),e.jsx("button",{onClick:()=>s(i),className:"shrink-0 rounded p-1 text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(M,{className:"h-3 w-3"})})]},i)),e.jsxs(S,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:a,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Anadir opcion"]})]})}function cs({block:l,onChange:t}){const a=l.config.options||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{block:l,onChange:t}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(rs,{options:a,onChange:s=>t("options",s)})})]})}function ns({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Selector",i=!!r.required,n=r.helpText||"",o=r.options??[];return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(d,{children:[c,i&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("select",{value:t??"",onChange:x=>a(x.target.value||null),disabled:s,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Seleccionar..."}),o.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n})]})}y({definition:j.select_field,EditorPreview:ls,ConfigPanel:cs,FormField:ns});function is({block:l}){const t=l.config,a=t.label||"Punto de inspeccion",s=t.withObservation!==!1,r=t.maintenanceLevel||"general",c=!!t.required;return e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`shrink-0 rounded px-1.5 py-0.5 text-[9px] font-medium ${$e[r]}`,children:Z[r]}),e.jsxs("span",{className:"flex-1 text-xs font-medium",children:[a,c&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"rounded border border-green-200 bg-green-50 px-2 py-0.5 text-[9px] font-medium text-green-600",children:"OK"}),e.jsx("span",{className:"rounded border border-red-200 bg-red-50 px-2 py-0.5 text-[9px] font-medium text-red-600",children:"NOK"}),e.jsx("span",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-0.5 text-[9px] font-medium text-gray-500",children:"N/A"})]})]}),s&&e.jsx("div",{className:"mt-1 ml-16",children:e.jsx("div",{className:"h-5 rounded border border-dashed border-gray-200 bg-gray-50/50 px-2 flex items-center",children:e.jsx("span",{className:"text-[9px] text-gray-300",children:"Observaciones..."})})})]})}function os({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:s=>t("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nivel de mantenimiento"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(Z).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(a.maintenanceLevel||"general")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("maintenanceLevel",s),children:r},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`withObs-${l.id}`,checked:a.withObservation!==!1,onChange:s=>t("withObservation",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`withObs-${l.id}`,className:"text-xs cursor-pointer",children:"Con campo de observaciones"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!a.required,onChange:s=>t("required",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]})]})}const ds=[{key:"ok",label:"OK",activeClass:"bg-green-600 text-white border-green-600"},{key:"nok",label:"NOK",activeClass:"bg-red-600 text-white border-red-600"},{key:"na",label:"N/A",activeClass:"bg-gray-500 text-white border-gray-500"}];function xs({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Punto de inspeccion",i=r.withObservation!==!1,n=!!r.required,o=t??{valor:null,observacion:""},x=h=>{s||a({...o,valor:o.valor===h?null:h})},m=h=>{s||a({...o,observacion:h})};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs(d,{className:"flex-1",children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx("div",{className:"flex gap-1",children:ds.map(h=>e.jsx("button",{type:"button",onClick:()=>x(h.key),disabled:s,className:`px-3 py-1 text-xs font-semibold rounded border transition-colors ${o.valor===h.key?h.activeClass:"border-gray-300 text-gray-500 hover:border-gray-400"} disabled:opacity-50 disabled:cursor-not-allowed`,children:h.label},h.key))})]}),i&&e.jsx(G,{value:o.observacion,onChange:h=>m(h.target.value),placeholder:"Observaciones...",rows:2,readOnly:s,disabled:s,className:"text-sm"})]})}y({definition:j.tristate,EditorPreview:is,ConfigPanel:os,FormField:xs});function ms({block:l}){const t=l.config,a=t.label||"Lista de verificacion",s=t.items||[];return e.jsxs("div",{className:"py-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:a}),s.length===0?e.jsx("div",{className:"text-[10px] text-gray-300 italic",children:"Sin items definidos"}):e.jsx("div",{className:"space-y-0.5",children:s.map((r,c)=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ve,{className:"h-3 w-3 text-gray-300 shrink-0"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:r.label})]},c))})]})}function us({items:l,onChange:t}){const a=()=>{const c=l.length+1;t([...l,{key:`item_${c}`,label:`Item ${c}`}])},s=c=>{t(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((x,m)=>m===c?{...x,[i]:n}:x);t(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-xs",children:"Items"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin items definidos"}),l.map((c,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{value:c.key,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"key",o)},placeholder:"clave",className:"h-7 text-xs font-mono flex-1"}),e.jsx(u,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-7 text-xs flex-1"}),e.jsx("button",{onClick:()=>s(i),className:"shrink-0 rounded p-1 text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(M,{className:"h-3 w-3"})})]},i)),e.jsxs(S,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:a,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Anadir item"]})]})}function hs({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:s=>t("label",s.target.value),className:"h-8"})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(us,{items:a.items||[],onChange:s=>t("items",s)})})]})}function ps({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Lista de verificacion",i=r.items||[],n=!!r.required,o=t??[],x=m=>{if(s)return;const h=o.includes(m)?o.filter(g=>g!==m):[...o,m];a(h)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),i.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Sin items definidos"}):e.jsx("div",{className:"space-y-1.5",children:i.map(m=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:o.includes(m.key),onChange:()=>x(m.key),disabled:s,className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm text-gray-700",children:m.label})]},m.key))})]})}y({definition:j.checklist,EditorPreview:ms,ConfigPanel:hs,FormField:ps});function gs({col:l,value:t}){const a=String(t??"");switch(l.type){case"checkbox":return e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`h-3 w-3 rounded-sm border ${a==="true"?"bg-primary border-primary":"border-gray-300"}`})});case"tristate":{const s=a||null;return e.jsx("div",{className:"flex gap-0.5 justify-center",children:["OK","NOK","NA"].map(r=>e.jsx("span",{className:`px-1 rounded text-[8px] font-medium ${s===r?r==="OK"?"bg-green-100 text-green-700":r==="NOK"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-500":"text-gray-300"}`,children:r},r))})}case"select":return e.jsx("span",{className:"text-gray-400 italic",children:a||"Seleccionar..."});default:return e.jsx("span",{className:"text-gray-500",children:a})}}function fs({block:l}){const t=l.config,a=t.label||"Tabla",s=t.columns||[],r=t.fixedRows||[],c=t.allowAddRows!==!1,i=t.headerBg||"#1f2937",n=!!t.compact;if(s.length===0)return e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:a}),e.jsx("div",{className:"rounded border border-dashed border-gray-200 p-4 text-center text-[10px] text-gray-300",children:"Sin columnas definidas"})]});const o=r.slice(0,3),x=r.length>3?r.length-3:0,m=n?"px-1.5 py-0.5":"px-2 py-1";return e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:a}),e.jsxs("div",{className:"rounded border overflow-hidden",children:[e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:i},children:s.map(h=>e.jsx("th",{className:`${m} text-left font-medium text-white`,style:{width:h.width!=="auto"?h.width:void 0},children:h.label},h.key))})}),e.jsx("tbody",{children:o.length>0?o.map((h,g)=>e.jsx("tr",{className:g%2===1?"bg-gray-50":"",children:s.map(p=>e.jsx("td",{className:m,children:e.jsx(gs,{col:p,value:h[p.key]})},p.key))},g)):e.jsx("tr",{children:s.map(h=>e.jsx("td",{className:m,children:e.jsx("div",{className:"h-3 bg-gray-100 rounded"})},h.key))})})]}),x>0&&e.jsxs("div",{className:"bg-gray-50 border-t px-2 py-0.5 text-[9px] text-gray-400 text-center",children:["y ",x," mas..."]}),c&&e.jsx("div",{className:"bg-gray-50 border-t px-2 py-0.5 text-[9px] text-gray-400 text-center italic",children:"+ filas dinamicas"})]})]})}const bs=[{value:"text",label:"Texto"},{value:"number",label:"Numero"},{value:"date",label:"Fecha"},{value:"checkbox",label:"Checkbox"},{value:"tristate",label:"Tristate"},{value:"select",label:"Selector"}];function js({columns:l,onChange:t}){const a=()=>{const c=l.length+1;t([...l,{key:`col_${c}`,label:`Columna ${c}`,type:"text",width:"auto"}])},s=c=>{t(l.filter((i,n)=>n!==c))},r=(c,i,n)=>{const o=l.map((x,m)=>m===c?{...x,[i]:n}:x);t(o)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-xs",children:"Columnas"}),l.length===0&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Sin columnas definidas"}),l.map((c,i)=>e.jsxs("div",{className:"rounded border p-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[10px] font-medium text-muted-foreground",children:["Columna ",i+1]}),e.jsx("button",{onClick:()=>s(i),className:"rounded p-0.5 text-muted-foreground hover:text-destructive",children:e.jsx(M,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsx(u,{value:c.key,onChange:n=>{const o=n.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();r(i,"key",o)},placeholder:"clave",className:"h-6 text-[10px] font-mono"}),e.jsx(u,{value:c.label,onChange:n=>r(i,"label",n.target.value),placeholder:"Etiqueta",className:"h-6 text-[10px]"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("select",{value:c.type,onChange:n=>r(i,"type",n.target.value),className:"h-6 flex-1 rounded border text-[10px] px-1",children:bs.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsx(u,{value:c.width,onChange:n=>r(i,"width",n.target.value),placeholder:"auto",className:"h-6 w-16 text-[10px]",title:"Ancho (auto, 100px, 20%, etc.)"})]}),c.type==="select"&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-muted-foreground",children:"Opciones (una por linea)"}),e.jsx("textarea",{value:(c.options||[]).join(`
`),onChange:n=>{const o=n.target.value.split(`
`).filter(x=>x.trim());r(i,"options",o)},placeholder:`Opcion 1
Opcion 2`,className:"w-full rounded border text-[10px] px-1 py-0.5 resize-none",rows:3})]})]},i)),e.jsxs(S,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:a,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Anadir columna"]})]})}function vs({columns:l,rows:t,onChange:a}){if(l.length===0)return e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Filas fijas"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Define columnas primero para poder anadir filas fijas."})]});const s=()=>{const i={};l.forEach(n=>{i[n.key]=""}),a([...t,i])},r=i=>{a(t.filter((n,o)=>o!==i))},c=(i,n,o)=>{const x=t.map((m,h)=>h===i?{...m,[n]:o}:m);a(x)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{className:"text-xs",children:["Filas fijas (",t.length,")"]}),t.length>0&&e.jsx("div",{className:"rounded border overflow-x-auto",children:e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[l.map(i=>e.jsx("th",{className:"px-1.5 py-1 text-left font-medium",children:i.label},i.key)),e.jsx("th",{className:"w-6"})]})}),e.jsx("tbody",{children:t.map((i,n)=>e.jsxs("tr",{className:"border-t",children:[l.map(o=>e.jsx("td",{className:"px-0.5 py-0.5",children:e.jsx(u,{value:String(i[o.key]||""),onChange:x=>c(n,o.key,x.target.value),className:"h-5 text-[10px] border-0 bg-transparent px-1"})},o.key)),e.jsx("td",{className:"px-0.5",children:e.jsx("button",{onClick:()=>r(n),className:"rounded p-0.5 text-muted-foreground hover:text-destructive",children:e.jsx(M,{className:"h-2.5 w-2.5"})})})]},n))})]})}),e.jsxs(S,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:s,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Anadir fila fija"]})]})}function Ns({block:l,onChange:t}){const a=l.config,s=a.columns||[];return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:r=>{const c=r.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",c)},placeholder:"nombre_tabla",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:r=>t("label",r.target.value),className:"h-8"})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(js,{columns:s,onChange:r=>t("columns",r)})}),e.jsx("div",{className:"border-t pt-3",children:e.jsx(vs,{columns:s,rows:a.fixedRows||[],onChange:r=>t("fixedRows",r)})}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsx(d,{className:"text-xs font-semibold",children:"Estilo de tabla"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color cabecera"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.headerBg||"#1f2937",onChange:r=>t("headerBg",r.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.headerBg||"#1f2937",onChange:r=>t("headerBg",r.target.value),className:"h-8 font-mono text-xs flex-1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`compact-${l.id}`,checked:!!a.compact,onChange:r=>t("compact",r.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`compact-${l.id}`,className:"text-xs cursor-pointer",children:"Compacta (padding reducido)"})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`allowAdd-${l.id}`,checked:a.allowAddRows!==!1,onChange:r=>t("allowAddRows",r.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`allowAdd-${l.id}`,className:"text-xs cursor-pointer",children:"Permitir anadir filas"})]}),a.allowAddRows!==!1&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Min filas"}),e.jsx(u,{type:"number",min:0,value:a.minRows||0,onChange:r=>t("minRows",Math.max(0,Number(r.target.value)||0)),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Max filas"}),e.jsx(u,{type:"number",min:1,value:a.maxRows||50,onChange:r=>t("maxRows",Math.max(1,Number(r.target.value)||50)),className:"h-8"})]})]})]})]})}function ys({col:l,value:t,onChange:a,readOnly:s}){switch(l.type){case"checkbox":return e.jsx("div",{className:"flex justify-center py-1",children:e.jsx("input",{type:"checkbox",checked:t===!0||t==="true",onChange:r=>a(r.target.checked),disabled:s,className:"h-4 w-4 rounded border-gray-300"})});case"tristate":{const r=t,c=[{label:"OK",color:"text-gray-400 border-gray-200",activeColor:"bg-green-100 text-green-700 border-green-300"},{label:"NOK",color:"text-gray-400 border-gray-200",activeColor:"bg-red-100 text-red-700 border-red-300"},{label:"NA",color:"text-gray-400 border-gray-200",activeColor:"bg-gray-100 text-gray-600 border-gray-300"}];return e.jsx("div",{className:"flex gap-0.5 justify-center py-0.5",children:c.map(i=>e.jsx("button",{type:"button",disabled:s,className:`px-1.5 py-0.5 rounded border text-[11px] font-medium transition-colors ${r===i.label?i.activeColor:i.color} ${s?"cursor-default":"cursor-pointer hover:opacity-80"}`,onClick:()=>{s||a(r===i.label?null:i.label)},children:i.label},i.label))})}case"select":{const r=l.options||[];return e.jsxs("select",{value:String(t??""),onChange:c=>a(c.target.value||null),disabled:s,className:"h-8 w-full rounded border-0 bg-transparent text-sm px-1 focus:ring-1 focus:ring-primary",children:[e.jsx("option",{value:"",children:"—"}),r.map(c=>e.jsx("option",{value:c,children:c},c))]})}case"date":return e.jsx(u,{type:"date",value:String(t??""),onChange:r=>a(r.target.value||null),readOnly:s,disabled:s,className:"h-8 text-sm border-0 bg-transparent focus-visible:ring-1 px-1"});default:return e.jsx(u,{type:l.type==="number"?"number":"text",value:String(t??""),onChange:r=>a(r.target.value||null),readOnly:s,disabled:s,className:"h-8 text-sm border-0 bg-transparent focus-visible:ring-1 px-1"})}}function ws({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Tabla",i=r.columns||[],n=r.allowAddRows!==!1,o=r.maxRows||50,x=!!r.required,m=r.headerBg||"#1f2937",h=!!r.compact,g=t??[],p=(N,f,b)=>{if(s)return;const v=g.map((C,D)=>D===N?{...C,[f]:b}:C);a(v)},w=()=>{if(s||g.length>=o)return;const N={};for(const f of i)N[f.key]=null;a([...g,N])},P=N=>{s||a(g.filter((f,b)=>b!==N))};if(i.length===0)return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:c}),e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Sin columnas definidas"})]});const k=h?"px-1 py-0.5":"px-2 py-1";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:[c,x&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx("div",{className:"rounded border overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:m},children:[i.map(N=>e.jsx("th",{className:`${k} text-left text-xs font-medium text-white`,style:{width:N.width!=="auto"?N.width:void 0},children:N.label},N.key)),!s&&n&&e.jsx("th",{className:`${k} w-10`})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:i.length+(!s&&n?1:0),className:"px-3 py-4 text-center text-xs text-gray-400 italic",children:["Sin datos. ",n&&!s&&"Pulsa + para anadir una fila."]})}):g.map((N,f)=>e.jsxs("tr",{className:f%2===1?"bg-gray-50":"bg-white",children:[i.map(b=>e.jsx("td",{className:k,children:e.jsx(ys,{col:b,value:N[b.key],onChange:v=>p(f,b.key,v),readOnly:!!s})},b.key)),!s&&n&&e.jsx("td",{className:"px-1 py-1 text-center",children:e.jsx(S,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-red-500",onClick:()=>P(f),children:e.jsx(M,{className:"h-3.5 w-3.5"})})})]},f))})]})}),n&&!s&&g.length<o&&e.jsxs(S,{type:"button",variant:"outline",size:"sm",className:"gap-1",onClick:w,children:[e.jsx(F,{className:"h-3.5 w-3.5"}),"Anadir fila"]})]})}y({definition:j.table,EditorPreview:fs,ConfigPanel:Ns,FormField:ws});function ks({block:l}){const t=l.config,a=t.label||"Imagen",s=t.maxFiles||1;return e.jsxs("div",{className:"py-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:a}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border-2 border-dashed border-gray-200 bg-gray-50/50 p-6 gap-1",children:[e.jsx(X,{className:"h-8 w-8 text-gray-300"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["Hasta ",s," archivo",s>1?"s":""]})]})]})}function Cs({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:s=>t("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`multi-${l.id}`,checked:!!a.allowMultiple,onChange:s=>t("allowMultiple",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`multi-${l.id}`,className:"text-xs cursor-pointer",children:"Permitir multiples"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Maximo de archivos"}),e.jsx(u,{type:"number",min:1,max:20,value:a.maxFiles||1,onChange:s=>t("maxFiles",Math.max(1,Math.min(20,Number(s.target.value)||1))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Tamano maximo (MB)"}),e.jsx(u,{type:"number",min:1,max:50,value:a.maxSizeMB||5,onChange:s=>t("maxSizeMB",Math.max(1,Math.min(50,Number(s.target.value)||5))),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(U).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(a.width||"full")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("width",s),children:r},s))})]})]})}function _s({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Imagen",i=r.maxFiles||1,n=r.maxSizeMB||5,o=!!r.required,x=t??[],m=$.useRef(null),h=p=>{if(!p||s)return;const w=i-x.length,P=Array.from(p).slice(0,w);for(const k of P){if(k.size>n*1024*1024){alert(`"${k.name}" supera el limite de ${n} MB.`);continue}if(!k.type.startsWith("image/")){alert(`"${k.name}" no es una imagen valida.`);continue}const N=new FileReader;N.onload=()=>{const f={name:k.name,data:N.result};a([...x,f])},N.readAsDataURL(k)}m.current&&(m.current.value="")},g=p=>{s||a(x.filter((w,P)=>P!==p))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{children:[c,o&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((p,w)=>e.jsxs("div",{className:"relative group rounded border overflow-hidden",style:{width:120,height:90},children:[e.jsx("img",{src:p.data,alt:p.name,className:"w-full h-full object-cover"}),!s&&e.jsx("button",{type:"button",onClick:()=>g(w),className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(se,{className:"h-3 w-3"})}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 bg-black/50 text-white text-[9px] px-1 py-0.5 truncate",children:p.name})]},w))}),!s&&x.length<i&&e.jsxs("div",{onClick:()=>{var p;return(p=m.current)==null?void 0:p.click()},onDragOver:p=>{p.preventDefault(),p.stopPropagation()},onDrop:p=>{p.preventDefault(),p.stopPropagation(),h(p.dataTransfer.files)},className:"flex flex-col items-center justify-center gap-2 rounded border-2 border-dashed border-gray-300 bg-gray-50 p-6 cursor-pointer hover:border-blue-400 hover:bg-blue-50/30 transition-colors",children:[e.jsx(ye,{className:"h-6 w-6 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Arrastra imagenes o haz clic para seleccionar"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["Max ",n," MB por archivo",i>1&&` · ${x.length}/${i} archivos`]})]}),e.jsx("input",{ref:m,type:"file",accept:"image/*",multiple:i>1,onChange:p=>h(p.target.files),className:"hidden"}),s&&x.length===0&&e.jsxs("div",{className:"flex items-center justify-center gap-2 rounded border border-dashed border-gray-200 p-6",children:[e.jsx(X,{className:"h-6 w-6 text-gray-300"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Sin imagenes"})]})]})}y({definition:j.image,EditorPreview:ks,ConfigPanel:Cs,FormField:_s});function Ps({block:l}){const t=l.config,a=t.label||"Firma",s=t.role||"",r=!!t.required;return e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[a,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded border border-gray-200 bg-gray-50/50 p-4 gap-1",children:[e.jsx(be,{className:"h-5 w-5 text-gray-300"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"Firma"}),s&&e.jsx("span",{className:"text-[9px] text-gray-300",children:s})]})]})}function $s({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Clave (snake_case)"}),e.jsx(u,{value:a.key||"",onChange:s=>{const r=s.target.value.replace(/[^a-z0-9_]/g,"").toLowerCase();t("key",r)},placeholder:"nombre_campo",className:"h-8 font-mono text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Etiqueta"}),e.jsx(u,{value:a.label||"",onChange:s=>t("label",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Rol"}),e.jsx(u,{value:a.role||"",onChange:s=>t("role",s.target.value),placeholder:"Tecnico PAS, Responsable cliente...",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`required-${l.id}`,checked:!!a.required,onChange:s=>t("required",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:`required-${l.id}`,className:"text-xs cursor-pointer",children:"Obligatorio"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Ancho"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(U).map(([s,r])=>e.jsx("button",{className:`rounded border px-2 py-1 text-xs ${(a.width||"half")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("width",s),children:r},s))})]})]})}const I=400,E=180;function Ss({block:l,value:t,onChange:a,readOnly:s}){const r=l.config,c=r.label||"Firma",i=r.role||"",n=!!r.required,o=t??null,x=$.useRef(null),m=$.useRef(!1),[h,g]=$.useState(!1);$.useEffect(()=>{const f=x.current;if(!f)return;const b=f.getContext("2d");if(b)if(b.clearRect(0,0,I,E),o){const v=new window.Image;v.onload=()=>{b.drawImage(v,0,0,I,E),g(!0)},v.src=o}else g(!1)},[o]);const p=$.useCallback(f=>{const b=x.current;if(!b)return{x:0,y:0};const v=b.getBoundingClientRect(),C=I/v.width,D=E/v.height;if("touches"in f){const z=f.touches[0]||f.changedTouches[0];return{x:(z.clientX-v.left)*C,y:(z.clientY-v.top)*D}}return{x:(f.clientX-v.left)*C,y:(f.clientY-v.top)*D}},[]),w=$.useCallback(f=>{var C;if(s)return;f.preventDefault(),m.current=!0;const b=(C=x.current)==null?void 0:C.getContext("2d");if(!b)return;const v=p(f);b.beginPath(),b.moveTo(v.x,v.y),b.lineWidth=2,b.lineCap="round",b.lineJoin="round",b.strokeStyle="#1a1a1a"},[s,p]),P=$.useCallback(f=>{var C;if(!m.current||s)return;f.preventDefault();const b=(C=x.current)==null?void 0:C.getContext("2d");if(!b)return;const v=p(f);b.lineTo(v.x,v.y),b.stroke(),g(!0)},[s,p]),k=$.useCallback(()=>{if(!m.current)return;m.current=!1;const f=x.current;if(!f)return;const b=f.toDataURL("image/png");a(b)},[a]),N=()=>{var b;if(s)return;const f=(b=x.current)==null?void 0:b.getContext("2d");f&&f.clearRect(0,0,I,E),g(!1),a(null)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(d,{children:[c,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"}),i&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground font-normal",children:["(",i,")"]})]}),!s&&h&&e.jsxs(S,{type:"button",variant:"ghost",size:"sm",className:"gap-1 text-xs h-7",onClick:N,children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),"Borrar"]})]}),e.jsx("div",{className:`rounded border ${s?"border-gray-200 bg-gray-50":"border-gray-300 bg-white"} overflow-hidden`,children:e.jsx("canvas",{ref:x,width:I,height:E,className:`w-full touch-none ${s?"cursor-not-allowed opacity-70":"cursor-crosshair"}`,style:{maxWidth:"100%",height:"auto",aspectRatio:`${I}/${E}`},onMouseDown:w,onMouseMove:P,onMouseUp:k,onMouseLeave:k,onTouchStart:w,onTouchMove:P,onTouchEnd:k})}),!s&&!h&&e.jsx("p",{className:"text-[10px] text-muted-foreground text-center",children:"Dibuja tu firma con el raton o el dedo"})]})}y({definition:j.signature,EditorPreview:Ps,ConfigPanel:$s,FormField:Ss});function Is({block:l}){const t=l.config.section||"portada",a=J.find(c=>c.id===t),s=(a==null?void 0:a.label)||t,r=(a==null?void 0:a.color)||"#6b7280";return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-sm select-none",style:{backgroundColor:`${r}15`,borderLeft:`4px solid ${r}`},children:[e.jsx(ue,{className:"h-4 w-4 shrink-0",style:{color:r}}),e.jsx("span",{className:"text-sm font-semibold tracking-wide",style:{color:r},children:s}),e.jsx("div",{className:"flex-1 border-t border-dashed ml-2",style:{borderColor:`${r}40`}})]})}function Es({block:l}){const t=l.config.section||"portada",a=J.find(c=>c.id===t),s=(a==null?void 0:a.label)||t,r=(a==null?void 0:a.color)||"#6b7280";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Seccion"}),e.jsxs("div",{className:"flex items-center gap-2 rounded border px-3 py-2",style:{borderColor:r,backgroundColor:`${r}10`},children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:r}}),e.jsx("span",{className:"text-sm font-medium",style:{color:r},children:s})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:["Este separador marca el inicio de la seccion ",e.jsx("strong",{children:s}),". No se puede mover, duplicar ni eliminar. Todos los bloques debajo pertenecen a esta seccion hasta el siguiente separador."]}),t==="intermedia"&&e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed border-l-2 border-green-500 pl-2",children:"La pagina intermedia define la cabecera y pie que se repiten en todas las paginas de contenido del documento."})]})}y({definition:j.section_separator,EditorPreview:Is,ConfigPanel:Es});function Ms({block:l}){const t=l.config,a=t.title||"Reporte de mantenimiento",s=t.subtitle||"",r=t.companyName||"PAS Robotics",c=t.logoPosition||"right",i=t.backgroundColor||"#000000",n=t.logoUrl||"";return e.jsxs("div",{className:"w-full px-8 py-10 flex items-center gap-6",style:{backgroundColor:i,minHeight:"200px",flexDirection:c==="right"?"row":"row-reverse"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium tracking-widest uppercase mb-2",style:{color:"rgba(255,255,255,0.6)"},children:r}),e.jsx("h1",{className:"text-2xl font-extrabold leading-tight text-white",children:a}),s&&e.jsx("p",{className:"text-sm mt-2",style:{color:"rgba(255,255,255,0.7)"},children:s})]}),e.jsx("div",{className:"shrink-0",children:n?e.jsx("img",{src:n,alt:"Logo",className:"h-20 w-auto object-contain"}):e.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-lg",style:{border:"2px dashed rgba(255,255,255,0.3)"},children:e.jsx(q,{className:"h-10 w-10",style:{color:"rgba(255,255,255,0.4)"}})})})]})}function Fs({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Titulo del reporte"}),e.jsx(u,{value:a.title||"",onChange:s=>t("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Subtitulo"}),e.jsx(u,{value:a.subtitle||"",onChange:s=>t("subtitle",s.target.value),className:"h-8",placeholder:"Ej: IRB1200-5/0.9 - IRC5 Compact"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nombre de empresa"}),e.jsx(u,{value:a.companyName||"",onChange:s=>t("companyName",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Posicion del logo"}),e.jsx("div",{className:"flex gap-1",children:["left","right"].map(s=>e.jsx("button",{className:`flex-1 rounded border px-2 py-1 text-xs ${(a.logoPosition||"right")===s?"border-primary bg-primary/5 text-primary":"border-border hover:bg-accent"}`,onClick:()=>t("logoPosition",s),children:s==="left"?"Izquierda":"Derecha"},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"URL del logo"}),e.jsx(u,{value:a.logoUrl||"",onChange:s=>t("logoUrl",s.target.value),placeholder:"https://...",className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color de fondo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.backgroundColor||"#000000",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.backgroundColor||"#000000",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]})]})}y({definition:j.cover_header,EditorPreview:Ms,ConfigPanel:Fs});function Ts({block:l}){const t=l.config,a=t.title||"Reporte de mantenimiento",s=t.subtitle||"",r=t.backgroundColor||"#1f2937",c=t.logoUrl||"";return e.jsxs("div",{className:"w-full px-4 py-2 flex items-center justify-between",style:{backgroundColor:r},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white text-xs font-semibold",children:a}),s&&e.jsx("span",{className:"text-xs ml-2",style:{color:"rgba(255,255,255,0.6)"},children:s})]}),e.jsx("div",{className:"shrink-0",children:c?e.jsx("img",{src:c,alt:"Logo",className:"h-6 w-auto object-contain"}):e.jsx("div",{className:"flex h-6 w-6 items-center justify-center",children:e.jsx(q,{className:"h-4 w-4",style:{color:"rgba(255,255,255,0.5)"}})})})]})}function Rs({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Titulo"}),e.jsx(u,{value:a.title||"",onChange:s=>t("title",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Subtitulo"}),e.jsx(u,{value:a.subtitle||"",onChange:s=>t("subtitle",s.target.value),className:"h-8",placeholder:"Ej: IRB1200-5/0.9 - IRC5 Compact"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"URL del logo"}),e.jsx(u,{value:a.logoUrl||"",onChange:s=>t("logoUrl",s.target.value),placeholder:"https://...",className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color de fondo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.backgroundColor||"#1f2937",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.backgroundColor||"#1f2937",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Esta cabecera aparece en la parte superior de todas las paginas intermedias del documento."})]})}y({definition:j.page_header,EditorPreview:Ts,ConfigPanel:Rs});function Ds({block:l}){const t=l.config,a=t.companyName||"PAS Robotics",s=t.showPageNumbers!==!1,r=t.showTriangle!==!1,c=t.backgroundColor||"#1f2937";return e.jsxs("div",{className:"w-full relative mt-2",children:[r&&e.jsx("div",{className:"absolute bottom-0 right-0",style:{width:0,height:0,borderRight:`80px solid ${c}`,borderTop:"80px solid transparent"}}),e.jsxs("div",{className:"flex items-end justify-between px-2 pb-1",style:{minHeight:"30px"},children:[e.jsx("span",{className:"text-[10px] font-bold",style:{color:c},children:a}),s&&e.jsx("span",{className:"text-[9px] text-gray-400 relative z-10",children:"Pagina X de N"})]})]})}function As({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nombre de empresa"}),e.jsx(u,{value:a.companyName||"",onChange:s=>t("companyName",s.target.value),className:"h-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showPageNumbers",checked:a.showPageNumbers!==!1,onChange:s=>t("showPageNumbers",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:"showPageNumbers",className:"text-xs cursor-pointer",children:"Mostrar numeros de pagina"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showTriangle",checked:a.showTriangle!==!1,onChange:s=>t("showTriangle",s.target.checked),className:"h-4 w-4 rounded"}),e.jsx(d,{htmlFor:"showTriangle",className:"text-xs cursor-pointer",children:"Mostrar triangulo decorativo"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color decorativo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.backgroundColor||"#1f2937",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.backgroundColor||"#1f2937",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Este pie aparece en la parte inferior de todas las paginas intermedias del documento."})]})}y({definition:j.page_footer,EditorPreview:Ds,ConfigPanel:As});function qs({block:l}){const t=l.config,a=t.logoUrl||"",s=t.backgroundColor||"#111827";return e.jsx("div",{className:"w-full flex items-center justify-center rounded-sm",style:{backgroundColor:s,minHeight:"200px"},children:a?e.jsx("img",{src:a,alt:"Logo",className:"max-h-20 max-w-[200px] object-contain"}):e.jsxs("div",{className:"flex flex-col items-center gap-2 opacity-60",children:[e.jsx(q,{className:"h-12 w-12 text-white"}),e.jsx("span",{className:"text-white/50 text-[10px]",children:"Logo de empresa"})]})})}function Ls({block:l,onChange:t}){const a=l.config;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"URL del logo"}),e.jsx(u,{value:a.logoUrl||"",onChange:s=>t("logoUrl",s.target.value),placeholder:"https://...",className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Color de fondo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:a.backgroundColor||"#111827",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 w-8 cursor-pointer rounded border"}),e.jsx(u,{value:a.backgroundColor||"#111827",onChange:s=>t("backgroundColor",s.target.value),className:"h-8 font-mono text-xs flex-1"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Pagina final del documento con fondo oscuro y logo centrado."})]})}y({definition:j.back_cover,EditorPreview:qs,ConfigPanel:Ls});export{re as A,Us as B,oe as C,Hs as F,X as I,ge as L,be as P,ve as S,j as a,Os as b,De as c,zs as g,H as u};
